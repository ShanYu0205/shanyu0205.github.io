<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>System Programming - 山雨欲来风满楼的博客</title><meta name="Description" content="这篇文章展示了系统编程的学习记录"><meta property="og:title" content="System Programming" />
<meta property="og:description" content="这篇文章展示了系统编程的学习记录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shanyu0205.github.io/posts/sp/l/" /><meta property="og:image" content="https://shanyu0205.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-11-29T16:30:10+08:00" /><meta property="og:site_name" content="My cool site" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://shanyu0205.github.io/logo.png"/>

<meta name="twitter:title" content="System Programming"/>
<meta name="twitter:description" content="这篇文章展示了系统编程的学习记录"/>
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://shanyu0205.github.io/posts/sp/l/" /><link rel="prev" href="https://shanyu0205.github.io/posts/serverfile/server-build/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "System Programming",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/shanyu0205.github.io\/posts\/sp\/l\/"
        },"genre": "posts","keywords": "笔记","wordcount":  13208 ,
        "url": "https:\/\/shanyu0205.github.io\/posts\/sp\/l\/","datePublished": "2023-09-04T00:00:00+00:00","dateModified": "2023-11-29T16:30:10+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "山雨欲来风满楼"
            },"description": "这篇文章展示了系统编程的学习记录"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="山雨欲来风满楼的博客"><span class="header-title-pre"><i class='fa-solid fa-mountain-sun'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于我 </a><a class="menu-item" href="https://github.com/ShanYu0205" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a><a href="javascript:void(0);" class="menu-item language" title="选择语言">
                    <i class="fa fa-globe" aria-hidden="true"></i>                      
                    <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/posts/sp/l/" selected>简体中文</option></select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="山雨欲来风满楼的博客"><span class="header-title-pre"><i class='fa-solid fa-mountain-sun'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于我</a><a class="menu-item" href="https://github.com/ShanYu0205" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a><a href="javascript:void(0);" class="menu-item" title="选择语言">
                    <i class="fa fa-globe fa-fw" aria-hidden="true"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/posts/sp/l/" selected>简体中文</option></select>
                </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">System Programming</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>山雨欲来风满楼</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>学习笔记</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-09-04">2023-09-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 13208 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 27 分钟&nbsp;<span id="/posts/sp/l/" class="leancloud_visitors" data-flag-title="System Programming">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#0-background">0 Background</a>
      <ul>
        <li><a href="#00-what-is-operating-system">0.0 What is Operating System?</a></li>
        <li><a href="#01-types-of-operating-systems">0.1 Types of Operating Systems</a></li>
        <li><a href="#02-single-tasking-system-vs-multi-tasking-system">0.2 Single Tasking System vs. Multi-tasking System</a></li>
        <li><a href="#03-hardware-basics">0.3 Hardware Basics</a></li>
        <li><a href="#04-protection-and-security">0.4 Protection and Security</a></li>
        <li><a href="#05-interrupts">0.5 Interrupts</a></li>
        <li><a href="#06-peripheral-devices">0.6 Peripheral Devices</a></li>
        <li><a href="#07-historical-perspective">0.7 Historical Perspective</a></li>
      </ul>
    </li>
    <li><a href="#what-is-system-programming">What is System Programming?</a></li>
    <li><a href="#1-unix">1 Unix</a>
      <ul>
        <li><a href="#11-the-unix-philosophy">1.1 The Unix Philosophy</a></li>
        <li><a href="#12-unix-kernel-and-system-calls">1.2 Unix Kernel and System Calls</a></li>
        <li><a href="#13-unix-commands-and-utilities">1.3 Unix Commands and Utilities</a></li>
        <li><a href="#14-unix-shell">1.4 Unix Shell</a></li>
        <li><a href="#15-unix-libraries--device-drivers">1.5 Unix Libraries &amp; Device Drivers</a></li>
        <li><a href="#features-of-unix">Features of Unix</a></li>
        <li><a href="#16-unix-is-portable">1.6 Unix is Portable</a></li>
        <li><a href="#17-unix-supports-multi-users-and-multi-tasking">1.7 Unix supports multi-users and multi-tasking</a></li>
        <li><a href="#18-unix-has-a-hierarchical-file-system">1.8 Unix has a hierarchical file system</a></li>
        <li><a href="#19-unix-shell-is-powerful">1.9 Unix shell is powerful</a></li>
        <li><a href="#110-unixs-pipe-is-novel">1.10 Unix&rsquo;s pipe is novel</a></li>
        <li><a href="#111-unix-supports-networking">1.11 Unix supports networking</a></li>
        <li><a href="#112-unix-is-robust">1.12 Unix is robust</a></li>
      </ul>
    </li>
    <li><a href="#unix-demo">Unix Demo</a></li>
    <li><a href="#2-unix-processes">2 Unix Processes</a>
      <ul>
        <li><a href="#21-common-definition">2.1 Common definition</a></li>
        <li><a href="#22-how-to-understand-it">2.2 How to understand it?</a></li>
        <li><a href="#23-how-to-turn-a-program-into-a-process">2.3 how to turn a program into a process?</a></li>
        <li><a href="#24-notion-of-threads-lightweight-processes">2.4 Notion of threads (lightweight processes)</a></li>
        <li><a href="#25-what-resources-to-share-and-what-not-to-share">2.5 What resources to share and what not to share?</a></li>
        <li><a href="#26-thread-realization-and-programming-interface">2.6 Thread realization and programming interface</a></li>
        <li><a href="#28-process-image">2.8 Process Image</a></li>
        <li><a href="#29-process-management">2.9 Process management</a></li>
        <li><a href="#210-related-portable-os-interface-posix-apis">2.10 Related Portable OS Interface (POSIX) APIs</a></li>
        <li><a href="#211-process-termination">2.11 Process termination</a></li>
        <li><a href="#212-background-processes">2.12 Background processes</a></li>
        <li><a href="#213-daemons">2.13 Daemons</a></li>
      </ul>
    </li>
    <li><a href="#3-unix-file-system">3 Unix File System</a>
      <ul>
        <li><a href="#31-unix-file-system">3.1 Unix File System</a></li>
        <li><a href="#32-how-to-handel-devices">3.2 How to handel devices?</a></li>
        <li><a href="#33-types-of-files-in-unix">3.3 Types of files in Unix</a></li>
        <li><a href="#34-difference-between-regular-and-directory-file">3.4 Difference between regular and directory file</a></li>
        <li><a href="#35-ls--l-command">3.5 <code>ls -l</code> command</a></li>
        <li><a href="#36-hierarchical-file-organization">3.6 Hierarchical file organization</a></li>
        <li><a href="#37-current-working-directory">3.7 Current working directory</a></li>
        <li><a href="#38-file-representation">3.8 File representation</a></li>
        <li><a href="#39-file-access">3.9 File Access</a></li>
        <li><a href="#310-io-redirection">3.10 I/O Redirection</a></li>
      </ul>
    </li>
    <li><a href="#4-device-driver">4 Device Driver</a>
      <ul>
        <li><a href="#41-what-is-a-device-driver">4.1 What is a device driver?</a></li>
        <li><a href="#42-related-os-infrastructure">4.2 Related OS infrastructure</a></li>
        <li><a href="#43-device-and-files">4.3 Device and Files</a></li>
        <li><a href="#44-major-design-issues">4.4 Major Design Issues</a></li>
        <li><a href="#45-types-of-device-drivers">4.5 Types of Device Drivers</a></li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
    <li><a href="#5-character-device-driver-development">5 Character Device Driver Development</a>
      <ul>
        <li><a href="#51-the-interface-for-user-programs">5.1 The Interface for User Programs</a></li>
        <li><a href="#52-device-driver-development">5.2 Device Driver Development</a></li>
        <li><a href="#53-the-generic-interface-for-char-device-driver-in-linux">5.3 The Generic Interface for Char Device Driver in Linux</a></li>
        <li><a href="#demo-task-1-1">Demo task 1</a></li>
        <li><a href="#54-kernel-memory-space-and-user-memory-space">5.4 Kernel Memory Space and User Memory Space</a></li>
      </ul>
    </li>
    <li><a href="#6-complier-design">6 Complier Design</a>
      <ul>
        <li><a href="#61-complier-overview">6.1 Complier Overview</a></li>
        <li><a href="#62-translation-mechanism">6.2 Translation Mechanism</a></li>
        <li><a href="#63-complier-and-phases-of-a-compliation">6.3 Complier and Phases of a Compliation</a></li>
        <li><a href="#64-lexical-analysisi">6.4 Lexical Analysis(I)</a></li>
        <li><a href="#65-lexical-analysisii">6.5 Lexical Analysis(II)</a></li>
      </ul>
    </li>
    <li><a href="#7-lexical-analysisiii---finite-automata">7 Lexical Analysis(III) - Finite Automata</a>
      <ul>
        <li><a href="#71-nfa-dfa-and-nfa-to-dfa-conversion">7.1 NFA, DFA, and NFA $\to$ DFA Conversion</a></li>
        <li><a href="#72-nondeterministic-finite-automata-nfa">7.2 Nondeterministic Finite Automata (NFA)</a></li>
        <li><a href="#73-state-transition-table">7.3 State Transition Table</a></li>
        <li><a href="#74-ε---transition">7.4 ε - Transition</a></li>
        <li><a href="#75-deterministic-finite-automata">7.5 Deterministic Finite Automata</a></li>
        <li><a href="#76-algorithm-simulating-a-dfa">7.6 Algorithm: Simulating a DFA</a></li>
        <li><a href="#77-regular-expression-to-nfa">7.7 Regular Expression to NFA</a></li>
        <li><a href="#78-regular-expression-to-nfa">7.8 Regular Expression to NFA</a></li>
      </ul>
    </li>
    <li><a href="#8-syntax-analysis">8 Syntax Analysis</a>
      <ul>
        <li><a href="#81-introduction">8.1 Introduction</a></li>
        <li><a href="#82-context-free-grammar">8.2 Context-Free Grammar</a></li>
        <li><a href="#83-parsing-methods">8.3 Parsing Methods</a></li>
        <li><a href="#84-first-and-follow-sets">8.4 First and Follow Sets</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><em><strong>这篇文章展示了系统编程的学习记录</strong></em></p>
<hr>
<h1 id="system-programming">System Programming</h1>
<h2 id="0-background">0 Background</h2>
<h3 id="00-what-is-operating-system">0.0 What is Operating System?</h3>
<p>An operating system is an intermediary between a computer user and the hardware</p>
<p>Make the hardware convenient to use</p>
<p>Manages system resources</p>
<p>Use the hardware in an efficient manner</p>
<!-- raw HTML omitted -->
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_0.png"
        data-srcset="./pic/0_0.png, ./pic/0_0.png 1.5x, ./pic/0_0.png 2x"
        data-sizes="auto"
        alt="./pic/0_0.png"
        title="./pic/0_0.png" /></p>
<hr>
<h3 id="01-types-of-operating-systems">0.1 Types of Operating Systems</h3>
<ul>
<li>
<p><strong>Batch</strong></p>
<ul>
<li>Single CPU</li>
<li>User submits large number of tasks at one time</li>
<li>OS decides what to run and when</li>
<li>Back-to-back single tasking</li>
</ul>
</li>
<li>
<p><strong>Time Sharing</strong></p>
<ul>
<li>Multiple users connected to a single CPU</li>
<li>Many user terminals</li>
<li>Multiple tasks run simultaneously using time-sharing, giving users the feeling of having multiple dedicated CPUs running in parallel</li>
</ul>
</li>
<li>
<p><strong>Parallel</strong></p>
<ul>
<li>Multiple CPUs closely coupled to form one computer</li>
<li>Higher throughput and better fault tolerance</li>
<li>Each CPU can be running batch tasking or time-sharing multitasking</li>
</ul>
</li>
<li>
<p><strong>Distributed</strong></p>
<ul>
<li>Multiple CPUs loosed coupled via networking</li>
</ul>
</li>
<li>
<p><strong>Real-time</strong></p>
<ul>
<li>Very strict response time requirements</li>
<li>Periodical tasks, every job of a task has a strict deadline</li>
</ul>
</li>
</ul>
<hr>
<h3 id="02-single-tasking-system-vs-multi-tasking-system">0.2 Single Tasking System vs. Multi-tasking System</h3>
<ul>
<li><strong>Single Tasking System</strong>
Each task, once started, executes to its very end without any interruption from other task(s).</li>
</ul>
<p>Simple to implement: sequential boundaries between tasks, and resource accesses.
Few security risks
Poor utilization of the CPU and other resources</p>
<blockquote>
<blockquote>
<p>Example: MS-DOS</p>
</blockquote>
</blockquote>
<ul>
<li><strong>Multi-tasking System</strong>
Very complex
Serious security issues     <br>
How to protect one task from another, which shares     <br>
the same block of memory</li>
</ul>
<p>Much higher utilization of system resources
Support interactive user/physical-world interface</p>
<blockquote>
<blockquote>
<p>Example: Unix, Windows NT</p>
</blockquote>
</blockquote>
<hr>
<h3 id="03-hardware-basics">0.3 Hardware Basics</h3>
<p>OS and hardware closely tied together
Basic hardware resources:CPU, Memory, Disk, I/O</p>
<hr>
<h4 id="031-cpu">0.3.1 CPU</h4>
<ul>
<li>
<p>CPU controls everything in the system     <br>
It is involved in any work needs to be done</p>
</li>
<li>
<p>Most precious resource     <br>
This is what you are paying for    <br>
Users would usually prefer high utilization (from useful work)</p>
</li>
<li>
<p>Only one process running on a CPU at a time</p>
</li>
<li>
<p>Millions or even billions of machine instructions per second       <br>
Getting faster all the time</p>
</li>
</ul>
<hr>
<h4 id="032-memory">0.3.2 Memory</h4>
<ul>
<li>Limited capacity     <br>
Never enough, and expanding over the years</li>
<li>Temporary (volatile) storage</li>
<li>Electronic storage    <br>
Fast, random access</li>
<li>Any process to run on the CPU must first be loaded into memory</li>
</ul>
<hr>
<h4 id="033-io">0.3.3 I/O</h4>
<ul>
<li>Many I/O devices   <br>
Keyboard, mouse, monitor, printer etc.</li>
<li>Most I/O devices are painfully slow</li>
<li>Need to find ways to deal with high I/O latency   <br>
Like multiprogramming</li>
</ul>
<hr>
<h3 id="04-protection-and-security">0.4 Protection and Security</h3>
<ul>
<li>OS must protect itself from users     <br>
Reserved memory only accessible by OS</li>
<li>OS may protect users from one another</li>
</ul>
<hr>
<h3 id="05-interrupts">0.5 Interrupts</h3>
<p>Modern OSs are event driven</p>
<p>Event is signaled by special hardware signal sent to the CPU</p>
<p>Two types of events
Hardware Interrupts: caused by external hardware, can occur at
anytime
Software Interrupts (aka Exceptions, Traps): caused by software,
synchronous to CPU clock</p>
<hr>
<h4 id="051-interrupt-philosophy">0.5.1 Interrupt Philosophy</h4>
<p>Use an interrupt table and special hardware to redirect CPU execution</p>
<p>By the end of interrupt handling, the CPU can resume the interrupted process</p>
<hr>
<h4 id="052-interrupt-table">0.5.2 Interrupt Table</h4>
<p>Large array of addresses indicating what code to run (<strong>interrupt routine</strong>) for a given interrupt</p>
<p>Each interrupt has a corresponding number associated with it
On Intel processors this is from 0 to 255
This gives fixed size interrupt table</p>
<p>Use the interrupt number to index into the array to find out what code to run (interrupt routine)</p>
<hr>
<h4 id="053-hardware-to-support-hardware-interrupts">0.5.3 Hardware to Support Hardware Interrupts</h4>
<p>Programmable Interrupt Controller (PIC)
Connected to I/O devices via Interrupt Request Lines (IRQ) or
Bus (e.g. PCI Express)</p>
<p>PIC connected to the CPU by a special line or bus</p>
<p>CPU<code>&lt;==&gt;</code>PIC<code>&lt;==&gt;</code>I/O devices</p>
<p><code>&lt;==&gt;</code> can be special signals via dedicated wire lines (IRQ), or special sequences of back-and-forth messages via bus(es) (virtual IRQ)</p>
<hr>
<h4 id="054-irq-architecture">0.5.4 IRQ Architecture</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_1.png"
        data-srcset="./pic/0_1.png, ./pic/0_1.png 1.5x, ./pic/0_1.png 2x"
        data-sizes="auto"
        alt="./pic/0_1.png"
        title="./pic/0_1.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_2.png"
        data-srcset="./pic/0_2.png, ./pic/0_2.png 1.5x, ./pic/0_2.png 2x"
        data-sizes="auto"
        alt="./pic/0_2.png"
        title="./pic/0_2.png" /></p>
<hr>
<h4 id="055-hardware-handling-of-interrupts-conventional-irq-as-an-example">0.5.5 Hardware Handling of Interrupts (Conventional IRQ as an Example)</h4>
<p>After each instruction executes, CPU checks if the IRQ pin voltage has been raised If so
1. Sets the system into kernel mode (if not already there)
2. Determine interrupt number (from PIC or instruction)
3. Read appropriate interrupt table entry
Special register contains base address of interrupt table
Each entry in table is fixed size so easy to calculate where to
look in memory (e.g. <code>memloc = iptr + 8 * intNum</code>)
4. Saves the process state to the stack (particularly, the program counter)
5. Saves error code to stack (if it exists)
6. Loads the program counter with the value stored in the interrupt table
This starts the CPU executing in the interrupt routine</p>
<hr>
<h3 id="06-peripheral-devices">0.6 Peripheral Devices</h3>
<p>Input Devices</p>
<p>Output Devices</p>
<p>Storage (memory is usually not considered as a peripheral)</p>
<hr>
<h4 id="061-peripheral-devices-for-embedded-systems">0.6.1 Peripheral Devices for Embedded Systems</h4>
<p><strong>Embedded Systems</strong>: computer systems that do not look like conventional computer systems, e.g. mobile devices, devices tightly coupled with the physical world (i.e. <strong>cyber-physical systems</strong>).</p>
<p>Input Devices: Sensors</p>
<p>Output Devices: Actuators</p>
<hr>
<h3 id="07-historical-perspective">0.7 Historical Perspective</h3>
<ul>
<li>Application built on top of hardware</li>
</ul>
<blockquote>
<blockquote>
<p>Problems:
Complexity: have to know the tedious low-level programming details of the hardware
Inflexibility: when the hardware changes, the application has to change with it.</p>
</blockquote>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_3.png"
        data-srcset="./pic/0_3.png, ./pic/0_3.png 1.5x, ./pic/0_3.png 2x"
        data-sizes="auto"
        alt="./pic/0_3.png"
        title="./pic/0_3.png" /></p>
<ul>
<li>Application built on top of OS</li>
</ul>
<blockquote>
<blockquote>
<p>Ideal:
OS application programming interface (API) hides the complexity and heterogeneity of hardware programming.
As long as the OS API remain the same, the hardware can change.
Design goal conflict: Full exploitation of hardware features Versus Full platform independence and simple API</p>
</blockquote>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_4.png"
        data-srcset="./pic/0_4.png, ./pic/0_4.png 1.5x, ./pic/0_4.png 2x"
        data-sizes="auto"
        alt="./pic/0_4.png"
        title="./pic/0_4.png" /></p>
<ul>
<li>Application built on top of OS</li>
</ul>
<blockquote>
<blockquote>
<p>Ideal:
OS application programming interface (API) hides the complexity and heterogeneity of hardware programming.
As long as the OS API remain the same, the hardware can change.
Design goal conflict: Full exploitation of hardware features Versus Full platform independence and simple API</p>
</blockquote>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_5.png"
        data-srcset="./pic/0_5.png, ./pic/0_5.png 1.5x, ./pic/0_5.png 2x"
        data-sizes="auto"
        alt="./pic/0_5.png"
        title="./pic/0_5.png" /></p>
<p>Want to exploit more features of the hardware: Application + OS
Want to be more platform independent and simpler API: Application + Virtual Machine (VM)</p>
<hr>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/0_6.png"
        data-srcset="./pic/0_6.png, ./pic/0_6.png 1.5x, ./pic/0_6.png 2x"
        data-sizes="auto"
        alt="./pic/0_6.png"
        title="./pic/0_6.png" /></p>
<p>Virtual Machine (VM) can hide the heterogeneity of OS APIs</p>
<p>As long as the VM API remain the same, the OS (and hardware) can change, and the application can remain the same.</p>
<hr>
<h2 id="what-is-system-programming">What is System Programming?</h2>
<ul>
<li>Application programs (+ application layer libraries)
<ul>
<li>Programs for direct interaction with users</li>
</ul>
</li>
<li>Compiler programs, assembler programs, linker programs
<ul>
<li>Tools that convert application programs to executables</li>
</ul>
</li>
<li>Operating systems kernel programs
<ul>
<li>Programs that interface other software with the hardware</li>
</ul>
</li>
</ul>
<p><strong>Layers of Programs (Development Time)</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_1.png"
        data-srcset="./pic/1_1.png, ./pic/1_1.png 1.5x, ./pic/1_1.png 2x"
        data-sizes="auto"
        alt="./pic/1_1.png"
        title="./pic/1_1.png" /></p>
<p><strong>Layers of Programs (Run Time)</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_3.png"
        data-srcset="./pic/1_3.png, ./pic/1_3.png 1.5x, ./pic/1_3.png 2x"
        data-sizes="auto"
        alt="./pic/1_3.png"
        title="./pic/1_3.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_2.png"
        data-srcset="./pic/1_2.png, ./pic/1_2.png 1.5x, ./pic/1_2.png 2x"
        data-sizes="auto"
        alt="./pic/1_2.png"
        title="./pic/1_2.png" /></p>
<h2 id="1-unix">1 Unix</h2>
<h3 id="11-the-unix-philosophy">1.1 The Unix Philosophy</h3>
<ul>
<li>Modular design</li>
<li>A collection of simple tools, with limited well-defined functions</li>
<li>File system</li>
<li>Inter-process communication</li>
<li>The tools can be easily composed (via <code>&gt;</code>, <code>&gt;&gt;</code>, <code>&lt;</code>, <code>|</code>,``) by a shell to accomplish complex tasks</li>
</ul>
<hr>
<h3 id="12-unix-kernel-and-system-calls">1.2 Unix Kernel and System Calls</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_4.png"
        data-srcset="./pic/1_4.png, ./pic/1_4.png 1.5x, ./pic/1_4.png 2x"
        data-sizes="auto"
        alt="./pic/1_4.png"
        title="./pic/1_4.png" /></p>
<p>Main duties</p>
<ul>
<li><strong>process</strong> scheduling and management</li>
<li><strong>inter-process</strong> communication</li>
<li><strong>memory</strong> management</li>
<li><strong>file</strong> management</li>
<li><strong>network</strong> stack management</li>
<li>date and <strong>time</strong> management</li>
<li>system <strong>accounting</strong></li>
<li><strong>security</strong></li>
<li><strong>device</strong> management</li>
<li><strong>interrupt</strong> and <strong>exception</strong> handling</li>
</ul>
<p>Other parts of the Unix system, as well as user programs, request the kernel for various services through <strong>system calls</strong></p>
<p>A <strong>system call</strong> is an entry point into the kernel, typically packaged as a function call, as part of the OS API.</p>
<ul>
<li>a software interrupt (trap) switches the CPU hardware to the <strong>kernel mode</strong></li>
<li>execute <strong>kernel routines</strong>
<ul>
<li>return kernel mode first, to the scheduler, check schedule of other tasks</li>
</ul>
</li>
<li>switches back(via scheduling*) to the <strong>user mode</strong> to resume the user application</li>
</ul>
<hr>
<h3 id="13-unix-commands-and-utilities">1.3 Unix Commands and Utilities</h3>
<ul>
<li>A large set of tools for various basic user level functions</li>
<li>A vocabulary and a grammar, to combine basic user level functions to nearly arbitrary sophisticated functions</li>
<li>Not part of the kernel, but a part of the OS</li>
<li>Typically accessed via the Shell</li>
</ul>
<hr>
<h3 id="14-unix-shell">1.4 Unix Shell</h3>
<ul>
<li>A powerful command interpreter (a user level application) for Unix – accepts user text commands and carries them out</li>
<li>Can combine various user level applications to serve more sophisticated functionalities</li>
</ul>
<hr>
<h3 id="15-unix-libraries--device-drivers">1.5 Unix Libraries &amp; Device Drivers</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_6.png"
        data-srcset="./pic/1_6.png, ./pic/1_6.png 1.5x, ./pic/1_6.png 2x"
        data-sizes="auto"
        alt="./pic/1_6.png"
        title="./pic/1_6.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/1_5.png"
        data-srcset="./pic/1_5.png, ./pic/1_5.png 1.5x, ./pic/1_5.png 2x"
        data-sizes="auto"
        alt="./pic/1_5.png"
        title="./pic/1_5.png" /></p>
<hr>
<h3 id="features-of-unix">Features of Unix</h3>
<ul>
<li>Portability</li>
<li>Multi-user Operation</li>
<li>Multitask Processing</li>
<li>Hierarchical File System</li>
<li>Powerful Shell</li>
<li>Pipes</li>
<li>Networking</li>
<li>Robustness</li>
</ul>
<hr>
<h3 id="16-unix-is-portable">1.6 Unix is Portable</h3>
<ul>
<li>
<p>Unix is a relatively hardware independent OS. Various mechanisms (device driver, various C program interfaces inside of the kernel and to the user level) are designed to encapsulate the hardware specifics, facilitating porting between hardware platforms.</p>
</li>
<li>
<p>One key to the portability is the device drivers, specific modules that encapsulate the hardware details from the other parts of the kernel and the user level.</p>
</li>
</ul>
<hr>
<h3 id="17-unix-supports-multi-users-and-multi-tasking">1.7 Unix supports multi-users and multi-tasking</h3>
<ul>
<li>For a single user, time sharing can still support multi-tasking. Multiple users may run multiple tasks concurrently.</li>
<li>Unix supports background processing, which allows a user to initiate a task &ldquo;in the background&rdquo; and then proceed to other activities. Unix time shares between the front-end commands and background jobs.</li>
<li>Unix allows the creation of new tasks from an existing task.</li>
</ul>
<hr>
<h3 id="18-unix-has-a-hierarchical-file-system">1.8 Unix has a hierarchical file system</h3>
<ul>
<li>Unix files are organized into separate directories.</li>
<li>Directories are themselves organized into a tree-like structure. There is one master directory, the so-called root directory, from which various sub-directories branch off.</li>
<li>The hierarchical structure offers a maximum flexibility for grouping information in a way that reflects its natural structure.
<ul>
<li>A single user&rsquo;s data may be grouped by activity</li>
<li>Data from many different users can be grouped according to corporate organization</li>
<li>As a result, stored data is easier to locate and manage</li>
</ul>
</li>
</ul>
<hr>
<h3 id="19-unix-shell-is-powerful">1.9 Unix shell is powerful</h3>
<p>T he Unix shell supports a number of convenient features, such as:</p>
<p>Redirection of application input and output, e.g.</p>
<ul>
<li><code>ls &gt; myfiles</code></li>
</ul>
<p>The ability to manipulate groups of files with a single command.</p>
<p>Executing a sequence of commands stored in a text file, called a &ldquo;shell script,&rdquo; allowing us to build our own commands, which may be parameterized.</p>
<p>Being used as a programming language that provides string-valued variables and control flow primitives including branching and iteration</p>
<hr>
<h3 id="110-unixs-pipe-is-novel">1.10 Unix&rsquo;s pipe is novel</h3>
<p>A pipe passes the standard output of one command directly to another command, to be used as its standard input, e.g.</p>
<ul>
<li><code>who | sort </code></li>
</ul>
<p>Allows any number of commands to be connected in a sequence, and automatically handles the data flow from one program to the next</p>
<ul>
<li><code>who | sort | lp</code></li>
</ul>
<p>Produces the same effect as if one large program, rather than several small ones, had been executed.</p>
<ul>
<li>Allowing the combination of several simple programs to perform more complex functions</li>
<li>Eliminating the need for new software development.</li>
</ul>
<hr>
<h3 id="111-unix-supports-networking">1.11 Unix supports networking</h3>
<p>Supports TCP/IP protocols, and provides a new OS abstraction, the socket, that allows application-level programs to access the Internet.</p>
<p>The socket abstraction acts as an interface between application level programs and the underlying TCP/IP protocols.</p>
<hr>
<h3 id="112-unix-is-robust">1.12 Unix is robust</h3>
<p>When encountered an error, a Unix program does not abort. Instead, the program receives a returned value indicating an error condition, and it is up to the program to check for the error and handle it.</p>
<p>Typically, a returned error value is <strong>negative</strong> if the return type is <code>int</code>, or a <code>NULL</code> if the return type is a <strong>pointer</strong>.</p>
<p>You can call the C library function <code>perror()</code> to output a message string to the standard error file, to further explain the error.</p>
<hr>
<h2 id="unix-demo">Unix Demo</h2>
<p>Task 2:</p>
<ul>
<li>
<p><code>ls</code>: list the files in the current directory</p>
<ul>
<li><code>ls -l</code>: list the files in the current directory in long format</li>
<li><code>ls -a</code>: list the files in the current directory, including the hidden files</li>
<li><code>ls -t</code>: list the files in the current directory, sorted by time</li>
<li><code>ls -lat</code>: list the files in the current directory, including the hidden files, in long format, sorted by time</li>
</ul>
</li>
<li>
<p><code>cd</code>: change the current directory</p>
<ul>
<li><code>.</code>: the current directory</li>
<li><code>..</code>: the parent directory</li>
</ul>
</li>
<li>
<p><code>cp</code>: copy a file</p>
<ul>
<li><code>cp file1 file2</code>: copy file1 to file2</li>
<li><code>cp file1 file2 file3 dir</code>: copy file1, file2, file3 to dir</li>
<li><code>cp -r dir1 dir2</code>: copy dir1(all the content) to dir2 recursively</li>
</ul>
</li>
<li>
<p><code>mv</code>: move a file</p>
<ul>
<li><code>mv file1 file2</code>: move file1 to file2</li>
<li><code>mv file1 file2 file3 dir</code>: move file1, file2, file3 to dir</li>
<li><code>mv dir1 dir2</code>: rename dir1 to dir2</li>
</ul>
</li>
<li>
<p><code>rm</code>: remove a file</p>
<ul>
<li><code>rm -rf dir</code>: remove dir recursively and forcefully</li>
</ul>
</li>
<li>
<p><code>mkdir</code>: make a directory</p>
<ul>
<li><code>mkdir dir</code>: make a directory named <code>dir</code></li>
</ul>
</li>
<li>
<p><code>who</code>: show the users who are currently logged in</p>
<ul>
<li><code>whami</code>: show the current user</li>
<li><code>who -q</code>: show the number of users who are currently logged in</li>
<li><code>who -u</code>: show the idle time of the users who are currently logged in</li>
</ul>
</li>
<li>
<p><code>cat</code>: concatenate files and print on the standard output</p>
<ul>
<li><code>cat file</code>: print the content of file on the standard output</li>
<li><code>cat file1 file2</code>: print the content of file1 and file2 on the standard output</li>
<li><code>cat file1 file2 &gt; file3</code>: concatenate file1 and file2, and write the result to file3</li>
<li><code>cat file1 file2 &gt;&gt; file3</code>: concatenate file1 and file2, and append the result to file3
 </li>
</ul>
</li>
<li>
<p><code>man</code>: an interface to the on-line reference manuals</p>
<ul>
<li><code>man command</code>: show the manual of command</li>
<li><code>man -k keyword</code>: search the manual for keyword</li>
<li><code>man -f command</code>: show the manual of command</li>
<li><code>man -a command</code>: show all the manual of command</li>
</ul>
</li>
<li>
<p><code>gcc</code>: GNU project C and C++ compiler</p>
<ul>
<li><code>gcc file</code>: compile file</li>
<li><code>gcc file -o file</code>: compile file and output the executable file to file</li>
<li><code>gcc file1 file2 -o file</code>: compile file1 and file2 and output the executable file to file</li>
</ul>
</li>
</ul>
<p>Task 3:</p>
<ul>
<li>
<p><code>vi</code>: a text editor</p>
<ul>
<li><code>vi file</code>: open file in vi</li>
<li><code>i</code>: enter insert mode</li>
<li><code>esc</code>: exit insert mode, enter command mode</li>
</ul>
</li>
<li>
<p>Under command mode:</p>
<ul>
<li><code>:w</code>: save the file</li>
<li><code>:q</code>: quit vi</li>
<li><code>:wq</code>: save and quit vi</li>
<li><code>:q!</code>: quit vi without saving</li>
<li><code>h</code>: move leftward; <code>l</code>: move rightward; <code>j</code>: move downward; <code>k</code>: move upward</li>
<li><code>w</code>: move rightward word by word; <code>b</code>: move leftward word by word</li>
<li><code>dw</code>: delete the word after the cursor</li>
<li><code>u</code>: undo the last command</li>
<li><code>dd</code>: delete the current line</li>
<li><code>$</code>: move to the end of the line; <code>^</code>: move to the beginning of the line</li>
</ul>
</li>
<li>
<p><code>gedit</code>: a text editor</p>
<ul>
<li><code>gedit file</code>: open file in gedit</li>
</ul>
</li>
</ul>
<p>Task 4: Shell output redirection</p>
<ul>
<li><code>who &gt; users</code>: redirect the output of <code>who</code> to file <code>users</code>, overwriting(replace) the original content of <code>users</code></li>
<li><code>who &gt;&gt; users</code>: append the output of <code>who</code> to file <code>users</code></li>
</ul>
<p>Task 5: Shell input redirection</p>
<ul>
<li><code>wc &lt; users</code>: redirect the content of <code>users</code> to <code>wc</code>, and count the number of lines, words, and characters in <code>users</code></li>
<li><code>wc -l</code>: count the number of lines</li>
<li><code>wc -l &lt; output.txt &gt; output1.txt</code>: count the number of lines in <code>output.txt</code>, and write the result to <code>output1.txt</code></li>
</ul>
<p>Task 6: write, compile, and run a C program</p>
<ul>
<li><code>vim hello.c</code>: write a C program in vi</li>
<li><code>gcc hello.c -o hello</code>: compile the C program and output the executable file to <code>hello</code></li>
<li><code>./hello</code>: run the executable file</li>
</ul>
<p>External Task: pipeline - make a pipe among processes</p>
<ul>
<li><code>ls -l | wc -l</code>: count the number of files in the current directory</li>
<li><code>ls -l | grep &quot;hello&quot;</code>: list the files in the current directory whose name contains &ldquo;hello&rdquo;</li>
<li><code>ls -l | grep &quot;hello&quot; | wc -l</code>: count the number of files in the current directory whose name contains &ldquo;hello&rdquo;</li>
</ul>
<hr>
<h2 id="2-unix-processes">2 Unix Processes</h2>
<ul>
<li>What is a process?</li>
<li>What does a process look like in the system?</li>
<li>When is a process created? By whom?</li>
<li>How is a process created? In how many ways?</li>
<li>When does a process stop? Can we wait for a process to die?</li>
<li>What is a process called if it never die?</li>
</ul>
<h3 id="21-common-definition">2.1 Common definition</h3>
<p>A process is an <strong>instance</strong> of a program in execution (the execution of the program has started but has not yet terminated).</p>
<p>Process is dynamic while program is static.</p>
<p>A process is the basic unit for competing the resources. In particular, it is the <strong>basic active entity</strong> to CPU scheduler.</p>
<hr>
<h3 id="22-how-to-understand-it">2.2 How to understand it?</h3>
<p>State of a computer at clock tick (i.e. discrete time) $i$:
$S(i)$ = (register 1&rsquo;s value, register 2&rsquo;s value, …,
1st memory byte&rsquo;s value, 2nd memory byte&rsquo;s value, …, 1st hard disk byte&rsquo;s value, 2nd hard disk byte&rsquo;s value, …,
peripheral 1&rsquo;s register 1&rsquo;s value, peripheral 1&rsquo;s register 2&rsquo;s value, …).</p>
<p>State of an execution $e$ at clock tick $i$: $s(e, i)$ = (resources used by $e$ at $i$, state of the resources used by $e$ at $i$).</p>
<p>A <strong>process</strong> is the time sequence of ${s(e, i)}$, where every two consecutive states $s(e, j)$ and $s(e, j+1)$ have causal relationship determined by the program logic and the OS.</p>
<hr>
<h3 id="23-how-to-turn-a-program-into-a-process">2.3 how to turn a program into a process?</h3>
<p>The program is read into memory.</p>
<p>A unique process ID is assigned.
OS kernel creates a process structure instance to record information related to this process.</p>
<p>Necessary resources to run the program are allocated.</p>
<p>The initial state $s(e,0)$ is set, which will trigger its next state $s(e, 1)$, which will trigger its next state $s(e,2)$, … determined by the program logic and the OS.</p>
<hr>
<h3 id="24-notion-of-threads-lightweight-processes">2.4 Notion of threads (lightweight processes)</h3>
<p>A <strong>process</strong> is the time sequence of ${s(e, i)}$, where every two consecutive states $s(e, j)$ and $s(e, j+1)$ have causal relationship determined by the program logic and the OS.</p>
<p>In older OSs, each process has its <strong>exclusive</strong> set of resources, even for processes that are related (e.g. sharing data). This is wasteful.</p>
<p>Modern OSs propose the notion of &ldquo;threads&rdquo;. Threads are processes that have <strong>shared resources</strong>, typically created by a same <strong>ancestor process</strong>. Because the resource allocation is more thrifty, threads are also called &ldquo;<strong>lightweight processes</strong>&rdquo;.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/2_1.png"
        data-srcset="./pic/2_1.png, ./pic/2_1.png 1.5x, ./pic/2_1.png 2x"
        data-sizes="auto"
        alt="./pic/2_1.png"
        title="./pic/2_1.png" /></p>
<ul>
<li>left: multi-processes - <code>fork()</code></li>
<li>right: multi-threads</li>
</ul>
<hr>
<h3 id="25-what-resources-to-share-and-what-not-to-share">2.5 What resources to share and what not to share?</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/2_2.png"
        data-srcset="./pic/2_2.png, ./pic/2_2.png 1.5x, ./pic/2_2.png 2x"
        data-sizes="auto"
        alt="./pic/2_2.png"
        title="./pic/2_2.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/2_3.png"
        data-srcset="./pic/2_3.png, ./pic/2_3.png 1.5x, ./pic/2_3.png 2x"
        data-sizes="auto"
        alt="./pic/2_3.png"
        title="./pic/2_3.png" /></p>
<ul>
<li>store and restore the register values</li>
<li>partition the registers into <strong>different sets</strong> <em><strong>temporarily</strong></em> for threads</li>
</ul>
<hr>
<h3 id="26-thread-realization-and-programming-interface">2.6 Thread realization and programming interface</h3>
<p>And at the user level, there is a de facto standard C thread programming interface: PThread (POSIX Thread).</p>
<p>But different OSs (even OSs belonging to the Unix family) have different ways to realize the concepts and the PThread programming interface.</p>
<p>For example, modern Linux no longer differentiate threads and processes, all are realized as copy-on-write (COW) processes (aka &ldquo;task&rdquo;). For example, every time the parent thread creates a new thread, in the Linux implementation, there is a parent COW process creating a child COW process.</p>
<hr>
<h3 id="28-process-image">2.8 Process Image</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/2_4.png"
        data-srcset="./pic/2_4.png, ./pic/2_4.png 1.5x, ./pic/2_4.png 2x"
        data-sizes="auto"
        alt="./pic/2_4.png"
        title="./pic/2_4.png" /></p>
<hr>
<h3 id="29-process-management">2.9 Process management</h3>
<p>Besides its image, a process has its corresponding meta data (in kernel) for the OS to manage it, e.g. <strong>process ID</strong>.</p>
<p>A Unix OS typically maintains a hierarchy of processes related by parent-child links: the process that requests to create another process is called the <strong>parent</strong> process, the created process is called the <strong>child</strong> process.</p>
<p>A child process inherits all the properties of its parent when it is created, but can change after creation (even changing its code image).</p>
<ul>
<li>Process ID – integer PID</li>
<li>Parent process ID – an integer PPID</li>
<li>User process ID – an integer UID
<ul>
<li>In Unix, each user has a unique user ID.</li>
<li>Each process is associated with a particular user called the owner of the process, which executes the program.</li>
<li>The owner has certain privileges with respect to the process.</li>
</ul>
</li>
</ul>
<p>Use <code>getpid</code>, <code>getppid</code>, and <code>getuid</code> to determine the <code>ID</code> of the current, parent, and the owner.</p>
<ul>
<li><code>ps</code> is the short for &ldquo;process status&rdquo;.</li>
<li><code>ps</code> lists your current processes</li>
<li><code>ps –a</code> lists more processes, including ones being run by other users and at other terminals (but not include the shells)</li>
<li><code>ps –l</code> prints longer, more information lines, including UID, PID, PPID, process status, etc.</li>
</ul>
<hr>
<h3 id="210-related-portable-os-interface-posix-apis">2.10 Related Portable OS Interface (POSIX) APIs</h3>
<blockquote>
<p>The <em>Portable Operating System Interface</em> (<strong>POSIX</strong>) is a family of standards specified by the IEEE Computer Society for maintaining compatibility between OSs.</p>
</blockquote>
<h4 id="demo-task-2">Demo Task 2</h4>
<ul>
<li><code>getpid</code>: get the process ID of the current process</li>
<li><code>getppid</code>: get the process ID of the parent process</li>
<li><code>getuid</code>: get the user ID of the current process</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; // Unix Standard</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Process ID: %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Parent ID: %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getppid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Onwer user ID: %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getuid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_1.png"
        data-srcset="./demopic/3_1.png, ./demopic/3_1.png 1.5x, ./demopic/3_1.png 2x"
        data-sizes="auto"
        alt="./demopic/3_1.png"
        title="./demopic/3_1.png" /></p>
<hr>
<h4 id="demo-task3">Demo Task3</h4>
<ul>
<li><code>fork()</code>: create a new process
<ul>
<li>Allocates a new chunk of memory and kernel data structure.</li>
<li>Copies the parent process&rsquo;s image and kernel data structure into the new process&rsquo;s, with needed modifications (e.g.PID, PPID).</li>
<li>Adds the new process to the set of &ldquo;Ready&rdquo; processes.</li>
<li>Returns control back to both processes (by setting the program counter in the respective image, and leaving the processes to the scheduler).</li>
<li>Return twice: once in the parent, once in the child.</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// demo 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">ret_from_fork</span><span class="p">,</span> <span class="n">mypid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">mypid</span> <span class="o">=</span> <span class="nf">getpid</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Before: my pid is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">mypid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret_from_fork</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;After: my pid is %d, fork() said %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">(),</span> <span class="n">ret_from_fork</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_2.png"
        data-srcset="./demopic/3_2.png, ./demopic/3_2.png 1.5x, ./demopic/3_2.png 2x"
        data-sizes="auto"
        alt="./demopic/3_2.png"
        title="./demopic/3_2.png" /></p>
<ul>
<li>use <code>man -S3  sleep</code> to see the manual of <code>sleep</code> system call</li>
<li>user <code>man sleep</code> to check sleep user command</li>
<li><strong>orphan</strong> process may happen since the parent process may terminate before the child process of the above code</li>
</ul>
<hr>
<h4 id="demo-task-4">Demo Task 4</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// demo 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">ret_from_fork</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Before: my pid is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="n">ret_from_fork</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;I am the child, ID  =  %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ret_from_fork</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;I am the parent, ID  =  %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;Fork failed!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_4.png"
        data-srcset="./demopic/3_4.png, ./demopic/3_4.png 1.5x, ./demopic/3_4.png 2x"
        data-sizes="auto"
        alt="./demopic/3_4.png"
        title="./demopic/3_4.png" /></p>
<h4 id="demo-task-5">Demo Task 5</h4>
<p>In-class exercise: forking a <strong>chain</strong> of processes</p>
<ul>
<li>the child process will fork a child process, then previous child process will die; the new child process will fork a child process, then previous child process will die; …</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// demo 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">childpid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">          <span class="k">break</span><span class="p">;</span> <span class="c1">//parent breaks out; child continues
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&#34;This is process %ld with parent %ld, i = %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">(),</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getppid</span><span class="p">(),</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_3.png"
        data-srcset="./demopic/3_3.png, ./demopic/3_3.png 1.5x, ./demopic/3_3.png 2x"
        data-sizes="auto"
        alt="./demopic/3_3.png"
        title="./demopic/3_3.png" /></p>
<ul>
<li><code>parallels@ubuntu-linux-20-04-desktop:~/Desktop/text$</code></li>
<li>the result above shows the parent process <code>PID=164147</code> has terminated before the child process <code>PID=164149</code> are created, so these two child processes become orphan processes, with parent process <code>PID=1193</code> (the <code>init</code> process - <strong>user</strong>)</li>
<li>For thr first <code>fork()</code>, the parent process will break out of the loop, and call <code>fprintf()</code>, then terminate. This parent process has the &ldquo;full image&rdquo; of whole c program. So when this process terminates, the whole c program terminates, and terminal will return <code>parallels@ubuntu-linux-20-04-desktop:~/Desktop/text$</code></li>
</ul>
<hr>
<h4 id="demo-task-6">Demo Task 6</h4>
<ul>
<li>In -class exercise: forking a <strong>fan</strong> of processes</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">pid_t</span> <span class="n">childpid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="n">childpid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span> <span class="c1">//child and error break out; parent continues
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&#34;This is process %ld with parent %ld</span><span class="se">\n</span><span class="s">, i = %d&#34;</span><span class="p">,(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">(),</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getppid</span><span class="p">(),</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Result</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_5.png"
        data-srcset="./demopic/3_5.png, ./demopic/3_5.png 1.5x, ./demopic/3_5.png 2x"
        data-sizes="auto"
        alt="./demopic/3_5.png"
        title="./demopic/3_5.png" /></p>
<ul>
<li>the order can be different since the parent and child processes are running concurrently which is scheduled by scheduler</li>
<li>the parent process of <code>PID=187708</code> is <code>PID=12244</code> (the <code>bash</code> process)</li>
<li>the result above shows the parent process <code>PID=187709</code> has terminated before the child process <code>PID=187710</code> are created, so this child processes become orphan process, with parent process <code>PID=1193</code> (the <code>init</code> process - <strong>user</strong>)</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./demopic/3_6.png"
        data-srcset="./demopic/3_6.png, ./demopic/3_6.png 1.5x, ./demopic/3_6.png 2x"
        data-sizes="auto"
        alt="./demopic/3_6.png"
        title="./demopic/3_6.png" /></p>
<hr>
<p>The <code>fork</code> system call creates a <strong>copy</strong> of the calling process. However, many application requires that the child process execute a <strong>different</strong> program from the parent process.</p>
<p>The <code>exec</code> family of system calls provides a facility for overlaying the calling process with a new executable module</p>
<ul>
<li><code>exec</code> loads a new executable and arguments into the process image, and calls the main(…) function.</li>
<li>If successful, <code>exec</code> never returns; the calling process is completely overlaid by the new program and is started from its beginning.</li>
<li>The traditional way to use the <code>fork-exec</code> combination is to have the child execute the new program while the parent continues to execute the original code.</li>
</ul>
<hr>
<h4 id="2101-wait-system-call">2.10.1 <code>wait()</code> system call</h4>
<p>After fork, both parent and child proceed independently. If a parent wants to wait until the child finishes, it executes <code>wait</code> or <code>waitpid</code> <strong>system call</strong>:</p>
<ul>
<li><code>pid_t wait(int *stat)</code>;
<ul>
<li>In general, the <code>wait</code> system call causes the caller process to pause until a <strong>child terminates</strong> or stops, or <strong>until the caller receives a signal</strong>.</li>
<li>The call returns right away if the process has <strong>no children</strong> or if <strong>a child has already terminated</strong> or <strong>stopped but has not yet been waited for</strong>.</li>
<li>The <code>stat</code> is a pointer to an integer variable that stores the exit status of the child.</li>
</ul>
</li>
</ul>
<p>If <code>wait</code> returns because a child terminated, the return value is <strong>positive</strong> and is the <strong>PID</strong> of that <strong>child</strong></p>
<p>Otherwise, wait returns <code>–1</code> and set <code>errno</code>.</p>
<ul>
<li><code>errno == ECHILD</code> indicates that there were no unwaited-for child processes;</li>
<li><code>errno == EINTR</code> indicates that the call was interrupted by a signal;</li>
</ul>
<p><strong>Three states of <code>wait()</code></strong></p>
<ul>
<li>no return</li>
<li>-1</li>
<li>child process ID</li>
</ul>
<hr>
<h4 id="2102-orphan-processes">2.10.2 Orphan processes</h4>
<p>If a <strong>parent</strong> process <strong>terminates first</strong> <strong>without waiting</strong> for its <strong>children</strong>, the <strong>children processes</strong> become <strong>orphan</strong> processes.</p>
<p>It is almost always poor programming practice to create orphaned processes, because there may be no indication to the user there are still processes running. If one of the ==orphaned processes== gets into an ==infinite loop==, the user may be completely unaware of it; and the orphaned process may continue execution even after the user has logged out.</p>
<hr>
<h4 id="demo-task-7">Demo Task 7</h4>
<ul>
<li>In -class demo: wait() example with process chain</li>
<li>Only one forked process is a child of the original process.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">pid_t</span> <span class="n">childpid</span><span class="p">,</span> <span class="n">waitreturn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span> <span class="c1">//parent breaks from for loop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// parent process waits for all children to terminate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// in parent process, childpid is the PID of the child process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// if child terminated, the return value is positive and is the PID of that child
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">!=</span> <span class="p">(</span><span class="n">waitreturn</span> <span class="o">=</span> <span class="nf">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">))){</span> <span class="c1">// child process has not terminated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">((</span><span class="n">waitreturn</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">EINTR</span><span class="p">))</span> <span class="c1">// child process has terminated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&#34;I am process %ld, my parent is %ld</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getpid</span><span class="p">(),</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="nf">getppid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>One of results</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">I am process 304564, my parent is 304563
</span></span><span class="line"><span class="cl">I am process 304563, my parent is 304562
</span></span><span class="line"><span class="cl">I am process 304562, my parent is 304561
</span></span><span class="line"><span class="cl">I am process 304561, my parent is 12244
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="2103-exec">2.10.3 <code>exec</code></h4>
<p>The <code>fork</code> system call creates a copy of the calling process. But many applications require the child process to execute code <strong>different</strong> from the parent&rsquo;s.</p>
<p>The <code>exec</code> family of system calls provides a facility for <strong>overlaying</strong> the calling process with a new executable module</p>
<p><code>exec</code> loads a new executable and arguments into the process image, and calls the <code>main(…)</code> function.
If successful, <code>exec</code> never returns; the calling process is completely overlaid by the new program and is started from its beginning.</p>
<p>The traditional way to use the <code>fork-exec</code> combination is to have the child execute the new program while the parent continues to execute the original code.</p>
<hr>
<h4 id="demo-task-8">Demo Task 8</h4>
<ul>
<li>In-class demo: <code>exec</code> example on creating a process to run <code>ls -l</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">pid_t</span> <span class="n">childpid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="n">childpid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Error in the fork&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* child code */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">execl</span><span class="p">(</span><span class="s">&#34;/usr/bin/ls&#34;</span><span class="p">,</span> <span class="s">&#34;ls&#34;</span><span class="p">,</span> <span class="s">&#34;-l&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// user/bin/ls is not the path of ls - use &amp; user
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Exec of ls failed&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">      <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">!=</span> <span class="nf">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="cm">/* parent code */</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;A signal occurred before child exited&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Compare with typing <code>ls -l</code> directly in terminal, the process performs <code>ls -l</code> in <code>./l3demo8</code> is the <strong>grandson</strong> of the terminal process, and the process performs <code>ls -l</code> in <code>./l3demo8</code> is the <strong>child</strong> of the terminal process.</p>
</blockquote>
<hr>
<h4 id="demo-task-9">Demo Task 9</h4>
<ul>
<li>In -class demo: <code>exec</code> example on creating a process to run <code>ls -l</code>
<ul>
<li><code>execvp()</code>:
<ul>
<li><code>p</code> - search the <strong>executable file</strong> in the <code>PATH</code> environment variable</li>
<li><code>v</code> - arguments are passed to main as an array of char *const pointers, each pointing to a C string.</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">pid_t</span> <span class="n">childpid</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">  <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;ls&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;-l&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//NULL pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="n">childpid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">())</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Error in the fork&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* child code */</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">execvp</span><span class="p">(</span><span class="s">&#34;ls&#34;</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;Exec of ls failed&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">      <span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">childpid</span> <span class="o">!=</span> <span class="nf">wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* parent code */</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;A signal occurred before child exited&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="2104-variations-of-exec">2.10.4 Variations of <code>exec</code></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">execl</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="n">cont</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,...);</span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">execle</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="err">…</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">envp</span><span class="p">[]);</span> <span class="kt">int</span> <span class="nf">execlp</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">arg0</span><span class="p">,</span> <span class="p">...);</span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">execv</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]);</span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">execve</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[],</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">envp</span><span class="p">[]);</span> <span class="kt">int</span> <span class="nf">execvp</span><span class="p">(</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>path</code> : C string (a <code>NULL</code> ended array of <code>char</code>) representing the full path of the executable file
<code>file</code> : C string representing only the file name of the executable file, the path is searched from the <code>PATH</code> environment
<code>arg0</code> :  should be the same as file name, the 0th argument passed to main.
<code>...</code> : a list of char const * pointers, each points to a C string, as arguments passed to main; the list must end with a NULL.
<code>argv</code> : an array of char const * pointers, each points to a C string, as arguments passed to main.
<code>envp</code> : an array of char const *, each points to a C string of format &ldquo;environment_variable_name=value&rdquo;.
<code>l</code>: arguments are passed to main as a list of char const * pointers, each pointing to a C string; the list must end with a NULL.
<code>v</code>: arguments are passed to main as an array of char const * pointers, each pointing to a C string.
<code>e</code>: an array of environment variable &ldquo;environment_variable_name=value&rdquo; pairs are explicitly and entirely passed to the new process image.
<code>p</code>: use the PATH environment to search for the executable file.</p>
<p><strong>An opened file descriptor remains open in the new process image</strong>,  unless was <code>fcntled</code> with <code>FD_CLOEXEC</code> or opened with <code>O_CLOEXEC</code>. This is how <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> are opened for the child process.</p>
<hr>
<h4 id="demo-task-10">Demo Task 10</h4>
<ul>
<li>In-class demo: <code>exec</code> has no return.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Old image: pid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">  <span class="nf">execlp</span><span class="p">(</span><span class="s">&#34;./newimage&#34;</span><span class="p">,</span> <span class="s">&#34;newimage&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Old image: hello</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;New image: pid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="p">.</span><span class="o">/</span><span class="n">l3demo10_old</span>
</span></span><span class="line"><span class="cl"><span class="n">Old</span> <span class="nl">image</span><span class="p">:</span> <span class="n">pid</span><span class="o">=</span><span class="mi">187708</span>
</span></span><span class="line"><span class="cl"><span class="n">New</span> <span class="nl">image</span><span class="p">:</span> <span class="n">pid</span><span class="o">=</span><span class="mi">187708</span> <span class="c1">// same PID
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>exec</code> will not create a new process, still the same process. The memory will be re-written by the new image.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="o">*</span> <span class="n">envp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">envp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;PATH=test&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">envp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Old image: pid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>  
</span></span><span class="line"><span class="cl">  <span class="nf">execle</span><span class="p">(</span><span class="s">&#34;./newimage&#34;</span><span class="p">,</span> <span class="s">&#34;newimage&#34;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">envp</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Old image: hello</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/wait.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;New image: pid=%d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;New image: PATH=%s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getenv</span><span class="p">(</span><span class="s">&#34;PATH&#34;</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>e</code>: entire</li>
</ul>
<hr>
<h3 id="211-process-termination">2.11 Process termination</h3>
<p>Upon termination of a process, the OS de-allocates the resources held by the process, updates the appropriate statistics, and notifies other processes, specifically these include:</p>
<ul>
<li>cancel pending timers and signals;</li>
<li>release virtual memory  spaces;</li>
<li>release locks, closing open files;</li>
<li>notifying the parent in response to a wait system call.</li>
</ul>
<p>What happens if the parent is not currently executing a <code>wait()</code>?</p>
<p>The child process&rsquo;s kernel management meta info (e.g. task struct) will remain there, though the child process image is gone. The child process hence becomes a <strong>zombie</strong>.</p>
<p>A normal termination occurs if there was</p>
<ul>
<li>A <code>return</code> from <code>main</code>,</li>
<li>An implicit <code>return</code> from <code>main</code>,</li>
<li>A call to the C function <code>exit</code>, or</li>
<li>A call to the <code>_exit</code> system call</li>
</ul>
<p><code>exit</code> calls user-defined exit handlers and may provide additional cleanup before it invokes the <code>_exit</code> system call.</p>
<p><code>exit</code> takes a single, integer argument, called <strong>exit status</strong>, which will be made available to the parent process (which may be waiting). By convention, a zero means success, some non-zero value means something has gone wrong.</p>
<hr>
<h4 id="2111-abnormal-process-termination">2.11.1 Abnormal process termination</h4>
<p>A process can terminate abnormally by</p>
<ul>
<li>calling <code>abort</code>, causing the <code>SIGABRT</code> signal to be sent to the calling process, or</li>
<li>processing a signal that causes termination.</li>
</ul>
<p>A code dump may be produced.</p>
<p>User-installed exit handlers will not be called upon abnormal termination.</p>
<hr>
<h3 id="212-background-processes">2.12 Background processes</h3>
<p>Recall that the shell is a command interpreter which</p>
<ul>
<li>Prompts for commands.</li>
<li>Reads the commands from standard input, forks children to execute the commands, and waits for the children to finish.</li>
<li>A user can terminate execution of a command by <code>ctrl-c</code>.</li>
</ul>
<p>Most shells interpret a command line ending with <code>&amp;</code> as one that should be executed by a background process</p>
<p>When a shell creates a background process, it does not wait for the process to complete before issuing a prompt and accepting additional commands.</p>
<p>Cannot send <code>ctrl-c</code> to a background process via the command input.</p>
<hr>
<h3 id="213-daemons">2.13 Daemons</h3>
<p>A daemon is a background process that normally runs indefinitely (have an infinite loop).</p>
<p>Unix relies on many daemon processes to perform routine tasks</p>
<ul>
<li><code>pageout</code> daemon handling paging,</li>
<li><code>in.rlogind</code> handling remote login requests,</li>
<li>The web server daemon receiving http connection requests</li>
<li>ftp daemon, mail daemon, … etc.</li>
</ul>
<h4 id="demo-task-11">Demo Task 11</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/stat.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;syslog.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#define MAX_I 100
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">pid_t</span> <span class="n">pid</span><span class="p">,</span> <span class="n">sid</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span><span class="o">*</span> <span class="n">p_output</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">sid</span> <span class="o">=</span> <span class="nf">setsid</span><span class="p">();</span> <span class="c1">// create the daemon process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">sid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">((</span><span class="nf">chdir</span><span class="p">(</span><span class="s">&#34;.&#34;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// change the directory to the current directory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Daemon: Hello!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="c1">// the child session will inherit the stdout from the parent, so it will still print out on the current terminal(&#34;parent&#34; session)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">close</span><span class="p">(</span><span class="n">STDIN_FILENO</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">close</span><span class="p">(</span><span class="n">STDOUT_FILENO</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">close</span><span class="p">(</span><span class="n">STDERR_FILENO</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Daemon: Goodbye!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> <span class="c1">// `STDIN/OUT` are closed, the child session cannot access parent I/O, so it will not print out in current terminal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="n">p_output</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span> <span class="err">“</span><span class="n">daemon_output</span><span class="p">.</span><span class="n">txt</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">a</span><span class="err">”</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">      <span class="nf">fprintf</span><span class="p">(</span><span class="n">p_output</span><span class="p">,</span> <span class="err">“</span><span class="o">%</span><span class="n">d</span><span class="err">\</span><span class="n">n</span><span class="err">”</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">      <span class="n">i</span> <span class="o">%=</span> <span class="n">MAX_I</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="nf">fclose</span><span class="p">(</span><span class="n">p_output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>umask</strong></p>
<ul>
<li><code>umask(0)</code>: set the <strong>file mode creation mask(umask)</strong> to 0, so that the file mode of the daemon output file is not restricted.</li>
<li><code>umask()</code> sets the calling process&rsquo;s file mode creation mask to <code>mask &amp; 0777</code>, <code>7</code> means <code>111</code> in binary
<ul>
<li><code>open()</code> and <code>mkdir()</code></li>
<li><code>mkdir()</code>: the mode of the created  directory  is  (<code>mode  &amp; ~umask &amp; 0777</code>)
<ul>
<li><code>mode</code> is default mode</li>
<li>e.g. <code>umask(0)</code> -&gt; <code>mkdir()</code> -&gt; <code>0777 &amp; ~0 &amp; 0777</code> -&gt; <code>0777</code>: the deafult mode will be remained</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>setsid</strong></p>
<ul>
<li>although <code>setsid</code> will move to another session, but the opened file is still be accessed</li>
<li>the child process calls <code>setsid()</code> to create a new session and obtain a new session ID (SID). If setsid() fails (returns -1), the program exits with a failure status.</li>
<li>The child process then changes the current working directory to the root directory using <code>chdir(&quot;.&quot;)</code>. If the <code>chdir()</code> call fails, the program exits with a failure status.</li>
<li>child process closes the standard input, standard output, and standard error file descriptors. This is done to <strong>disconnect</strong> the daemon process from the terminal, as it no longer needs them.</li>
</ul>
<blockquote>
<p>above code is a daemon process, which is terminal-realted not login-related.</p>
</blockquote>
<hr>
<h2 id="3-unix-file-system">3 Unix File System</h2>
<blockquote>
<p>What is a file in Unix?
How many types of files?
How are the files in a file system structured?
How is a file represented in memory and disk?
How to find the file using its name?
How to access files from a Unix program?</p>
</blockquote>
<h3 id="31-unix-file-system">3.1 Unix File System</h3>
<blockquote>
<p>File system provides abstractions of naming, storage, and access of files.
A file is a container of some information: data, program.
In Unix, <strong>devices</strong> (disks, tapes, CD ROMs, screens, keyboards, printers, mice, etc.) are also treated as <strong>files</strong>, so as to provide a unified and device independent interface to applications.</p>
</blockquote>
<h3 id="32-how-to-handel-devices">3.2 How to handel devices?</h3>
<ul>
<li><strong>system calls</strong> to the programmer for performing control and I/O to devices.</li>
<li>handled by <strong>device drivers</strong>, which hide the details of device operation and protect the devices from unauthorized use.</li>
</ul>
<p>In Unix, disk files and other devices are <strong>named</strong> and <strong>accessed</strong> in the <strong>same way as data files</strong>.</p>
<ul>
<li>Unix provides a uniform device interface (called file descriptors).</li>
<li>Allow uniform access to most devices through file system calls – <code>open</code>,<code>close</code>, <code>read</code>, <code>write</code>, etc.</li>
</ul>
<hr>
<h3 id="33-types-of-files-in-unix">3.3 Types of files in Unix</h3>
<ol>
<li><strong>Regular file</strong>: an ordinary data file on disk – contains bytes of data organized into a linear array;</li>
<li><strong>Special file</strong>: a file representing a device – located in the /<code>dev</code> directory
<ul>
<li><strong>Block</strong> special file: devices transferring info in blocks or chunks, just like disks, CD ROM</li>
<li><strong>Character</strong> special file: devices transferring info in stream of bytes that must be accessed sequentially, just like keyboards, mice, printers, etc.</li>
</ul>
</li>
<li>Directories: provided to allow names (not physical locations) of files to be used.
<ul>
<li>User gives a file name and Unix makes a translation to the location of the physical file-done via directories</li>
</ul>
</li>
</ol>
<hr>
<h3 id="34-difference-between-regular-and-directory-file">3.4 Difference between regular and directory file</h3>
<ul>
<li>Contents: data vs file info</li>
<li>Operations: what can be done and who can do them, the access right</li>
</ul>
<hr>
<h3 id="35-ls--l-command">3.5 <code>ls -l</code> command</h3>
<p>For each file there are ten characters before the user and group owner. The first character shows the types of file</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_1.png"
        data-srcset="./pic/3_1.png, ./pic/3_1.png 1.5x, ./pic/3_1.png 2x"
        data-sizes="auto"
        alt="./pic/3_1.png"
        title="./pic/3_1.png" /></p>
<p><strong>access right</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_2.png"
        data-srcset="./pic/3_2.png, ./pic/3_2.png 1.5x, ./pic/3_2.png 2x"
        data-sizes="auto"
        alt="./pic/3_2.png"
        title="./pic/3_2.png" /></p>
<hr>
<h4 id="demo-task-1">Demo Task 1</h4>
<p><strong>What are the differences between a regular file and a device file?</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="o">&gt;</span><span class="n">cp</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">garbage</span> 
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span><span class="n">cp</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tty</span>
</span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span> <span class="n">cp</span> <span class="n">normal</span><span class="p">.</span><span class="n">txt</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">tty</span>
</span></span><span class="line"><span class="cl"><span class="n">Hello</span> <span class="n">world</span><span class="o">!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>content will be <strong>displayed</strong> on the terminal for <code>tty</code> device file</li>
</ul>
<hr>
<h3 id="36-hierarchical-file-organization">3.6 Hierarchical file organization</h3>
<p>A Unix file system has a <strong>hierarchical</strong> tree structure where <strong>internal nodes</strong> are <strong>directories</strong> and <strong>leaf nodes</strong> are <strong>files</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_3.png"
        data-srcset="./pic/3_3.png, ./pic/3_3.png 1.5x, ./pic/3_3.png 2x"
        data-sizes="auto"
        alt="./pic/3_3.png"
        title="./pic/3_3.png" /></p>
<ul>
<li>fully-quallified path name uniquely specifies a file: <code>/dirA/dirB/My1.dat.</code></li>
<li>relative pathname, begining from the current directory rather the root ditrectory: <code>../My2.dat</code></li>
</ul>
<hr>
<h3 id="37-current-working-directory">3.7 Current working directory</h3>
<blockquote>
<p>At anytime, every process has an associated directory called the current working directory (cwd)</p>
</blockquote>
<ul>
<li>Denoted by a dot <code>.</code>, e.g., <code>mv ../file1 .</code></li>
<li>The cwd associated with a user&rsquo;s login shell is called the user&rsquo;s <strong>home</strong> directory.</li>
<li><code>pwd</code> prints the name of <code>cwd</code></li>
<li>A relative pathname always starts with the path to the cwd.</li>
</ul>
<p>The C library function <code>getcwd</code> returns the pathname of the current working directory</p>
<ul>
<li><code>char *getcwd(char *buf, size_t size)</code></li>
<li><code>size</code> specifies maximum length pathname. If longer than the maximum, returns <code>NULL</code> and sets <code>errono to ERANGE</code>.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;errno.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">cwd</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nf">getcwd</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cwd</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Current working dir: %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">cwd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">perror</span><span class="p">(</span><span class="s">&#34;getcwd() error&#34;</span><span class="p">);</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="38-file-representation">3.8 File representation</h3>
<h4 id="381-i-node">3.8.1 i-node</h4>
<ul>
<li>Information about a filesystem structure is stored both on disk and main memory.</li>
<li>Unix uses a logical structure called <code>i-node</code> to store the information about a file on disk – each file in a file system is represented by an i-node:</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_4.png"
        data-srcset="./pic/3_4.png, ./pic/3_4.png 1.5x, ./pic/3_4.png 2x"
        data-sizes="auto"
        alt="./pic/3_4.png"
        title="./pic/3_4.png" /></p>
<ul>
<li><strong>i-nodes</strong> are <strong>stored</strong> at the front of each region of <strong>disk</strong> that contains a Unix file system.
<ul>
<li>both conceptual and physical</li>
<li>A regular file has a number called the <strong>i-number</strong>, which is an index into an array of the i-nodes on disk, one-to-one mapping.</li>
<li>Each i-node corresponds to a unique i-number (index).</li>
<li>data blocks may be placed in neighboring disk blocks, but it can not be guaranteed.</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_5.png"
        data-srcset="./pic/3_5.png, ./pic/3_5.png 1.5x, ./pic/3_5.png 2x"
        data-sizes="auto"
        alt="./pic/3_5.png"
        title="./pic/3_5.png" /></p>
<ul>
<li>more layers(tree structures) to access the data blocks</li>
<li>store pointers in data blocks</li>
</ul>
<p><strong>find the i-number of a file, by given the file name</strong></p>
<ul>
<li>A directory contains a list of entries mapping file names to i-numbers (hence the i-node).</li>
<li>A &lt;name, i-node&gt; pair is called a <strong>link</strong>. You can create many links for a file (multiple names).</li>
<li>i-nodes are the hidden part, while directories are the visible structure of the Unix file system.</li>
<li>Hence, the correspondence between a <strong>file name</strong> and its <strong>i-node</strong> is stored in the <strong>directory file</strong>.</li>
</ul>
<p><em>[Example of directory file]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_6.png"
        data-srcset="./pic/3_6.png, ./pic/3_6.png 1.5x, ./pic/3_6.png 2x"
        data-sizes="auto"
        alt="./pic/3_6.png"
        title="./pic/3_6.png" /></p>
<h4 id="382-hard-link--symbolic-link">3.8.2 Hard link &amp; Symbolic link</h4>
<p><em>[Example of directory file: hard link]</em>
Hard link creation command: <code>ln My1.dat My2.dat</code></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_7.png"
        data-srcset="./pic/3_7.png, ./pic/3_7.png 1.5x, ./pic/3_7.png 2x"
        data-sizes="auto"
        alt="./pic/3_7.png"
        title="./pic/3_7.png" /></p>
<p><strong>Hard link</strong></p>
<ul>
<li>create a new entry for the same <code>i-node</code>, when modifying any of entry, the result will change</li>
</ul>
<hr>
<p><em>[Example of directory file: symbolic link]</em></p>
<ul>
<li>create a new i-ndoe index</li>
</ul>
<p><strong>Symbolic link</strong></p>
<ul>
<li>normal symbolic link: when the <strong>&ldquo;root&rdquo;</strong> is moved, the link will be broken</li>
<li>absolute symbolic link: when the <strong>&ldquo;root&rdquo;</strong> is moved, the link will not be broken</li>
<li>i-node reference a new data block which stores a <strong>URL</strong>, of which the reference of source file</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_8.png"
        data-srcset="./pic/3_8.png, ./pic/3_8.png 1.5x, ./pic/3_8.png 2x"
        data-sizes="auto"
        alt="./pic/3_8.png"
        title="./pic/3_8.png" /></p>
<p><strong>absulute path or relative path</strong></p>
<ul>
<li>Hard links must be on the same file system, while symbolic links can cross file systems.</li>
<li>Hard linked files stay linked even if either one is moved; Symbolic linked files break if the original is moved.</li>
</ul>
<hr>
<p><strong>Remove links</strong></p>
<ul>
<li><strong>deep</strong> remove and <strong>shallow</strong> remove
<ul>
<li>deep - remove the <strong>entire</strong> file from disk</li>
<li>shallow - remove the <strong>reference</strong> not the file itself</li>
</ul>
</li>
<li>reference <strong>counter</strong>(<em>part of i-node in filr info.</em>) from the memory perspective to check using deep remove or shallow remove</li>
</ul>
<blockquote>
<p>The key of links is checking whether the reference/path is valid or not.</p>
</blockquote>
<h4 id="384-file-storage">3.8.4 File storage</h4>
<ul>
<li>12 <strong>direct pointer</strong> can point to $12 * 8KB = 96KB$ of file content.</li>
<li>A <strong>single indirect pointer</strong> points to a block of direct pointers. A block can contain 8KB/4bytes = 2K pointers = 2048 pointers. 2048 direct pointers can point to $2048 x 8KB = 16MB$ of file content.</li>
<li>A <strong>double indirect pointer</strong> points to 2048 single indirect pointers, that is $2048 * 16MB = 32GB$ of file content.</li>
<li>Similarly, a <strong>triple indirect pointer</strong> points to $64TB$ of file content.</li>
<li>So one I-node can at the most point to $64TB + 32GB + 16MB + 96KB$ of file content.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_9.png"
        data-srcset="./pic/3_9.png, ./pic/3_9.png 1.5x, ./pic/3_9.png 2x"
        data-sizes="auto"
        alt="./pic/3_9.png"
        title="./pic/3_9.png" /></p>
<hr>
<h3 id="39-file-access">3.9 File Access</h3>
<blockquote>
<p>In C programs, a file is represented by a <strong>file pointer</strong> or <strong>file descriptors</strong>.</p>
</blockquote>
<ul>
<li>provide logical names (handles) for performing device-independent I/O.</li>
</ul>
<p>Unix file system calls use file descriptors (via <code>open</code>, <code>read</code>, <code>write</code>, <code>close</code>, and <code>ioctl</code>).</p>
<p>ANSI C I/O library uses file pointers (via <code>fopen</code>, <code>fscanf</code>, <code>fprintf</code>, <code>fread</code>, <code>fwrite</code>, <code>fclose</code>, etc.).</p>
<p>File <strong>descriptors</strong> - (in <code>unistd.h</code>)</p>
<ul>
<li><strong>standard input</strong>: <code>STDIN_FILENO</code></li>
<li><strong>standard output</strong>: <code>STDOUT_FILENO</code></li>
<li><strong>standard error files</strong>: <code>STDERR_FILENO</code></li>
<li>Corresponding to <strong>constants</strong> <code>0</code>, <code>1</code>, <code>2</code> in <code>&lt;unistd.h&gt;</code></li>
</ul>
<p>file <strong>pointers</strong> - (in <code>stdio.h</code>)</p>
<ul>
<li><strong>standard input</strong>: <code>stdin</code></li>
<li><strong>standard onput</strong>: <code>stdout</code></li>
<li><strong>standard error files</strong>: <code>stderr</code></li>
</ul>
<hr>
<h4 id="391-file-descriptor">3.9.1 File Descriptor</h4>
<blockquote>
<p>low-level identifiers provided by the operating system to access files and I/O resources
Process <strong>specialized</strong></p>
</blockquote>
<ul>
<li>System File Table(SFT) entry contains information about whether a file(within a process) is opened for
<ul>
<li>read/write;</li>
<li>permission;</li>
<li>lock;</li>
<li>read/write offset etc.</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_10.png"
        data-srcset="./pic/3_10.png, ./pic/3_10.png 1.5x, ./pic/3_10.png 2x"
        data-sizes="auto"
        alt="./pic/3_10.png"
        title="./pic/3_10.png" /></p>
<blockquote>
<p>Several <strong>entries</strong> in SFT may point to the <strong>same</strong> physical file.</p>
</blockquote>
<ul>
<li>When new files are opened, it is assigned the <strong>lowest available FD</strong>.</li>
<li>Accessing files for I/O is a three-step process, whether it is a regular file or a device:
<ul>
<li>Open the file for I/O</li>
<li>Read and write to the file</li>
<li>Close the file when finished with I/O</li>
</ul>
</li>
</ul>
<p><strong>open a file</strong></p>
<blockquote>
<p><code>int open(const char* pathname, int flags)</code>
<code>int open(const char* pathname, int flags, mode_t mode)</code></p>
</blockquote>
<ul>
<li><code>pathname</code>: absolute or relative path name of the file to be opened</li>
<li><code>flags</code>: access mode - <code>O_RDONLY</code>, <code>O_WRONLY</code>, <code>O_RDWR</code> and bitwise-or&rsquo;d(using <code>|</code>) with sero or more of the following flags:
<ul>
<li><code>O_APPEND</code>: the file is opened in append mode.</li>
<li><code>O_CREAT</code>:  if the pathname does <strong>not</strong> exist, create the file as a regular file; must add the <strong>access permission mode parameter</strong> (e.g. <strong>0644</strong>).</li>
<li>&hellip;</li>
</ul>
</li>
</ul>
<p><strong>Return of open</strong></p>
<ul>
<li>Returns the opened file&rsquo;s file descriptor or <code>–1</code> if an error occurred (the <code>errno</code> is set accordingly)</li>
</ul>
<hr>
<p><strong>read a file</strong></p>
<blockquote>
<p>bytes = read(fd, buffer, count)</p>
</blockquote>
<ul>
<li>Read from file associated with <code>fd</code>; place <code>count</code> bytes into <code>buffer</code>
<ul>
<li><code>fd</code>: file descriptor to reasd from</li>
<li><code>buffer</code>: pointer to any array</li>
<li><code>count</code>: number of bytes to read</li>
</ul>
</li>
<li>Returns number of bytes read or <code>-1</code> if an error occured</li>
</ul>
<h4 id="demo-task-3">Demo Task 3</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;someFile&#34;</span><span class="p">,</span> <span class="n">O_RDONLY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="c1">// store in stack, no need to de-allocate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">char</span> <span class="o">*</span> <span class="n">buff2</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span> <span class="c1">// store in heap, need to de-allocate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">bytes</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nf">free</span><span class="p">(</span><span class="n">buff2</span><span class="p">);</span> <span class="c1">// de-allocate the memory or there will be memory leak
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>write a file - overwrite</strong></p>
<blockquote>
<p>bytes = write(fd, buffer, count)</p>
</blockquote>
<ul>
<li>Write contents of <code>buffer</code> to the file associated with <code>fd</code>, write <code>count</code> bytes into the file
<ul>
<li><code>O_TRUNC</code>: if the file already exists and is a regular file and the access mode allows writing, truncate it to length 0.</li>
<li><code>fd</code>: file descriptor to write to</li>
<li><code>buffer</code>: pointer to any array</li>
<li><code>count</code>: number of bytes to write</li>
</ul>
</li>
<li>Returns number of bytes written or <code>-1</code> if an error occured</li>
</ul>
<h4 id="demo-task-4-1">Demo Task 4</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">buff4</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">&#39;a&#39;</span><span class="p">,</span><span class="sc">&#39;b&#39;</span><span class="p">,</span><span class="sc">&#39;c&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">bytes_written</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">&#34;someFile&#34;</span><span class="p">,</span> <span class="n">O_WRONLY</span><span class="o">|</span><span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;sizeof(buffer) is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// char buffer[4];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bytes_written</span> <span class="o">=</span> <span class="nf">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;The %dth byte is %c</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">fsync</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">// flashes the content into disk before close (for written)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">// when open, close it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>close a file</strong></p>
<blockquote>
<p><code>return_val = close(fd)</code></p>
</blockquote>
<ul>
<li>Close an open file descriptor</li>
<li>Returns <code>0</code> if successful, <code>-1</code> if an error occured</li>
</ul>
<hr>
<h4 id="392-file-pointer">3.9.2 File Pointer</h4>
<blockquote>
<p>higher-level abstractions used by programming languages or libraries to manage the current <strong>position</strong> and perform high-level file operations.</p>
</blockquote>
<ul>
<li>A file pointer points to a data structure <code>FILE</code>, called a <strong>file structure</strong> in the user area of the process.</li>
<li>A file structure <strong>contains</strong> a <strong>buffer</strong> and a <strong>file descriptor</strong> (<em>so a file pointer is a handle to a handle</em>)</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_11.png"
        data-srcset="./pic/3_11.png, ./pic/3_11.png 1.5x, ./pic/3_11.png 2x"
        data-sizes="auto"
        alt="./pic/3_11.png"
        title="./pic/3_11.png" /></p>
<h4 id="demo-task-5-1">Demo Task 5</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">FILE</span> <span class="o">*</span><span class="n">myfp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">((</span><span class="n">myfp</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;/home/ann/my.dat&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;Could not fopen file</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fprintf</span><span class="p">(</span><span class="n">myfp</span><span class="p">,</span> <span class="s">&#34;This is a test&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>overwrite</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">fp</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;someFile&#34;</span><span class="p">,</span> <span class="s">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;Could nor fopen file.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fprintf</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&#34;This is a test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fflush</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong><code>fopen()</code> and <code>fclose()</code></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">FILE</span> <span class="o">*</span><span class="n">file_stream</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Path</code>: <code>char*</code>, absolute or relative path
Mode:</li>
<li><code>r</code> – open file for reading</li>
<li><code>r+</code> - open file for reading and writing</li>
<li><code>w</code> – overwrite file or create file for writing</li>
<li><code>w+</code> - open for reading and writing; overwrites file</li>
<li><code>a</code> – open file for appending (writing at end of file)</li>
<li><code>a+</code> - open file for appending and reading</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">fclose</span><span class="p">(</span><span class="n">file_stream</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Closes the opened file represented by <code>file_stream</code></li>
</ul>
<hr>
<p><strong>printf()</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">printf</span><span class="p">(</span><span class="n">formatted_string</span><span class="p">,</span> <span class="p">...)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>formatted_string</code>: string that describes the output information, variable types are escaped with <code>%</code></li>
<li>The formatted string is followed by as many expressions as are <strong>referenced</strong> in the formatted string</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_12.png"
        data-srcset="./pic/3_12.png, ./pic/3_12.png 1.5x, ./pic/3_12.png 2x"
        data-sizes="auto"
        alt="./pic/3_12.png"
        title="./pic/3_12.png" /></p>
<p><em>Escaping variable types</em></p>
<ul>
<li><code>%d</code>,<code>%i</code> – decimal integer</li>
<li><code>%u</code> – unsigned decimal integer</li>
<li><code>%o</code> – unsigned octal integer</li>
<li><code>%x</code>,<code>%X</code> – unsigned hexadecimal integer</li>
<li><code>%c</code> – character</li>
<li><code>%s</code> – string or character array</li>
<li><code>%f</code> – float</li>
<li><code>%e</code>,<code>%E</code> – double (scientific notation)</li>
<li><code>%g</code>,<code>%G</code> – double or float</li>
<li><code>%%</code> – outputs a <code>%</code> character</li>
</ul>
<h4 id="demo-task-6-1">Demo Task 6</h4>
<p><em>[Example]</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;The sum of %d, %d, and %d is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">65</span><span class="o">+</span><span class="mi">87</span><span class="o">+</span><span class="mi">33</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// output: The sum of 65, 87, and 33 is 185
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Error %s occurred at line %d </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">emsg</span><span class="p">,</span> <span class="n">lno</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// output: Error invalid variable occurred at line 27
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Hexadecimal form of %d is %x </span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">59</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// output: Hexadecimal form of 59 is 3B
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%%d = (%d) , %%i = (%i), %%u = (%u), %%o = (%o), %%x = (%x), %%X = %X</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;hwllo world.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> <span class="c1">// literal string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">1.12345678901234567890e20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">lf</span> <span class="o">=</span> <span class="mf">1.12345678901234567890e20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%%c = (%c).</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%%s = (%s).</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%%f = (%f), %%lf = (%lf), %%e = (%e), %%E = (%E), %%g = (%g), %%G = (%G).</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span><span class="n">lf</span><span class="p">,</span><span class="n">lf</span><span class="p">,</span><span class="n">lf</span><span class="p">,</span><span class="n">lf</span><span class="p">,</span><span class="n">lf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">%d = (-1) , %i = (-1), %u = (4294967295), %o = (37777777777), %x = (ffffffff), %X = FFFFFFFF
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>scanf()</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">scanf</span><span class="p">(</span><span class="n">formatted_string</span><span class="p">,</span> <span class="p">...)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Similar syntax as <code>printf</code>, only the formatted string represents the data that you are reading in.</li>
<li>Must pass variables by <strong>reference</strong>
<ul>
<li>e.g. <code>scanf(&quot; %d %c %s&quot;, &amp;int_var, &amp;char_var, string_var);</code>
<ul>
<li>the leading while space is to ask scanf to ignore white space(including niewline) characters</li>
<li>Other alternatives to flush the <code>\n</code> in input buffer include using <code>getchar()</code> after a <code>scanf()</code> call, using <code>%*c</code>, but the best is to use fgets() to get a line stead of using scanf</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>printf() and scanf() families</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">fprintf</span><span class="p">(</span><span class="n">file_stream</span><span class="p">,</span> <span class="n">formatted_string</span><span class="p">,</span> <span class="p">...)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Prints to a file stream instead of <code>stdout</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">sprintf</span><span class="p">(</span><span class="n">char_array</span><span class="p">,</span> <span class="n">formatted_string</span><span class="p">,</span> <span class="p">...)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Prints to a character array instead of <code>stdout</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">fprintf</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">[,</span> <span class="n">argument</span> <span class="p">]</span><span class="err">…</span><span class="p">);</span> <span class="kt">int</span> <span class="nf">sprintf</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">[,</span> <span class="n">argument</span><span class="p">]</span><span class="err">…</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">fscanf</span><span class="p">(</span><span class="n">file_stream</span><span class="p">,</span> <span class="n">formatted_string</span><span class="p">,</span> <span class="err">…</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Reads from a file stream instead of <code>stdin</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">sscanf</span><span class="p">(</span><span class="n">char_array</span><span class="p">,</span> <span class="n">formatted_string</span><span class="p">,</span> <span class="err">…</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Reads from a string instead of <code>stdin</code></li>
</ul>
<h4 id="demo-task-7-1">Demo Task 7</h4>
<p>fgets():</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s = </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>fscanf():</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">FILE</span><span class="o">*</span> <span class="n">datafile</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">datafile</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;mydata.txt&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nf">feof</span><span class="p">(</span><span class="n">datafile</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fscanf</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s">&#34;%d %c %s&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;i = %d, c = </span><span class="se">\&#39;</span><span class="s">%c</span><span class="se">\&#39;</span><span class="s">, s = </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s">.</span><span class="se">\n</span><span class="s">, i, c , buf&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="310-io-redirection">3.10 I/O Redirection</h3>
<blockquote>
<p>process modifies its file descriptor table entry so that it points to a different entry in the system file table.</p>
</blockquote>
<ul>
<li>Recall: to access a file, a process uses a file descriptor, which is an index into the process file descriptor table, which <strong>in turn</strong> points to an entry in the system file table.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_13.png"
        data-srcset="./pic/3_13.png, ./pic/3_13.png 1.5x, ./pic/3_13.png 2x"
        data-sizes="auto"
        alt="./pic/3_13.png"
        title="./pic/3_13.png" /></p>
<ul>
<li><code>cat</code>: reads a file and outputs to <code>stdout</code>.
<ul>
<li><code>cat test &gt; my.file</code></li>
</ul>
</li>
</ul>
<h4 id="3101-io-redirection-realization-using-table-dup">3.10.1 I/O redirection realization using Table <code>dup()</code></h4>
<ul>
<li><code>int dup(int oldfd)</code> duplicates the given file descriptor to the <strong>lowest</strong> numbered unused file descriptor in the file descriptor table.</li>
</ul>
<h4 id="demo-task-8-1">Demo Task 8</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;fcntl.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span><span class="o">*</span> <span class="n">cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;/bin/ls&#34;</span><span class="p">,</span> <span class="s">&#34;-l&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">O_CREAT</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//fd will be 3; a file will be opened in write mode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">fd2</span> <span class="o">=</span> <span class="nf">dup</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">//duplicate the fd-th pointer to entry 4, the lowest available entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">close</span><span class="p">(</span><span class="n">STDOUT_FILENO</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// the entry 1 is now available(free)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">dup</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">//duplicate the fd-th pointer into entry 1, &#34;my.dat&#34; become the standard output file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">execvp</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmd</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="c1">// the old process image is replaced by the new process image for ls
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// the File Descriptor Table is &#34;inherited&#34; by the new process image, 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// still the same process(PID), but the image is replaced
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">//close file descriptor 3 in the parent process.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_14.png"
        data-srcset="./pic/3_14.png, ./pic/3_14.png 1.5x, ./pic/3_14.png 2x"
        data-sizes="auto"
        alt="./pic/3_14.png"
        title="./pic/3_14.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_15.png"
        data-srcset="./pic/3_15.png, ./pic/3_15.png 1.5x, ./pic/3_15.png 2x"
        data-sizes="auto"
        alt="./pic/3_15.png"
        title="./pic/3_15.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_16.png"
        data-srcset="./pic/3_16.png, ./pic/3_16.png 1.5x, ./pic/3_16.png 2x"
        data-sizes="auto"
        alt="./pic/3_16.png"
        title="./pic/3_16.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_17.png"
        data-srcset="./pic/3_17.png, ./pic/3_17.png 1.5x, ./pic/3_17.png 2x"
        data-sizes="auto"
        alt="./pic/3_17.png"
        title="./pic/3_17.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_19.png"
        data-srcset="./pic/3_19.png, ./pic/3_19.png 1.5x, ./pic/3_19.png 2x"
        data-sizes="auto"
        alt="./pic/3_19.png"
        title="./pic/3_19.png" /></p>
<hr>
<h4 id="3102-communication-between-parentchild-via-pipe">3.10.2 Communication between parent/child via pipe</h4>
<ul>
<li>
<p>System call <code>pipe()</code> returns two file descriptors by whilch we can access the input/outpur of a pipe(and I/O mechanism)</p>
</li>
<li>
<p><code>int fd[2];</code></p>
</li>
<li>
<p><code>int pipe(int fd[2]);</code></p>
<ul>
<li>Return: 0 success; -1 error</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/3_18.png"
        data-srcset="./pic/3_18.png, ./pic/3_18.png 1.5x, ./pic/3_18.png 2x"
        data-sizes="auto"
        alt="./pic/3_18.png"
        title="./pic/3_18.png" /></p>
<h4 id="demo-task-9-1">Demo Task 9</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">fd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">pipe</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span> <span class="c1">//fd[0] is for read and fd[1] is for write
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">pid_t</span> <span class="n">child</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">  <span class="kt">char</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="s">&#34;hello world&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">child</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">//child process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span> <span class="c1">//a large enough buffer to share data 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">bytes_to_read</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">bytes_to_read</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">      <span class="n">bytes_to_read</span> <span class="o">-=</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;child process read: </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s"> .</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">//parent process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> 
</span></span><span class="line"><span class="cl">      <span class="kt">int</span> <span class="n">bytes_to_write</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span><span class="n">bytes_to_write</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="nf">write</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">,</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// &#34;+1&#34; for null byte, terminateing 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">bytes_to_write</span> <span class="o">-=</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nf">fsync</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">//flush the data into pipe before close
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;parent process written: </span><span class="se">\&#34;</span><span class="s">%s</span><span class="se">\&#34;</span><span class="s"> .</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">close</span><span class="p">(</span><span class="n">fd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="4-device-driver">4 Device Driver</h2>
<ul>
<li>What is a device driver?</li>
<li>Related OS infrastructure</li>
<li>Devices and files</li>
<li>Major design issues</li>
<li>Types of device drivers</li>
</ul>
<hr>
<h3 id="41-what-is-a-device-driver">4.1 What is a device driver?</h3>
<ul>
<li>Device driver is a special kind of <strong>library</strong>, which can be <strong>loaded</strong> into the OS <strong>kernel</strong>, and <em>links</em> application <strong>program</strong> with the <strong>I/O devices</strong></li>
</ul>
<hr>
<h3 id="42-related-os-infrastructure">4.2 Related OS infrastructure</h3>
<ul>
<li>Unix system architecture</li>
<li>File subsystem and its relations with char/block device driver tables</li>
<li>Char/block device driver tables</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/4_1.png"
        data-srcset="./pic/4_1.png, ./pic/4_1.png 1.5x, ./pic/4_1.png 2x"
        data-sizes="auto"
        alt="./pic/4_1.png"
        title="./pic/4_1.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/4_2.png"
        data-srcset="./pic/4_2.png, ./pic/4_2.png 1.5x, ./pic/4_2.png 2x"
        data-sizes="auto"
        alt="./pic/4_2.png"
        title="./pic/4_2.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/4_3.png"
        data-srcset="./pic/4_3.png, ./pic/4_3.png 1.5x, ./pic/4_3.png 2x"
        data-sizes="auto"
        alt="./pic/4_3.png"
        title="./pic/4_3.png" /></p>
<ul>
<li>Most of device derivers are character device drivers, like printer; block device driver operats on massive file system, like disk, CD-ROM, etc.</li>
</ul>
<p><strong>Advantages to separate device drivers from the OS</strong></p>
<ul>
<li>For OS designer
<ul>
<li>Devices may not be available when an OS is designed.</li>
<li>no need to worry about how to operate devices (set up registers, check statuses, …).</li>
<li>Focus on OS itself by providing a <strong>generic</strong> interface for device driver development.</li>
</ul>
</li>
<li>For Device driver designers
<ul>
<li>Do not need to worry about how I/O is managed in OS (how to design kernel data structures to efficiently operate devices, …)</li>
<li>Focus on implementing functions of devices with device-related commands following the <strong>generic</strong> I/O interface</li>
</ul>
</li>
</ul>
<hr>
<h3 id="43-device-and-files">4.3 Device and Files</h3>
<blockquote>
<p>devices are treated as special files.</p>
</blockquote>
<p>A file is associated with an <strong>inode</strong>. We can use <code>mknod &lt;file_name&gt; &lt;c or b&gt; &lt;major_number&gt; &lt;minor_number&gt;</code> to create a special filr for a device file</p>
<p>When we create a special file (an <strong>inode</strong>) for a device file, we associate <strong>major/minor</strong> numbers with the file (the <strong>inode</strong>).</p>
<p>Major number associated with a <strong>special file</strong> is used to <strong>identify</strong> its <strong>corresponding device drivers</strong> in the kernel.</p>
<h4 id="431-characterblock-device-files">4.3.1 Character/Block Device Files</h4>
<ul>
<li>Two types of device files: character and block</li>
</ul>
<p><em>[Example]</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls -l /dev/null
</span></span><span class="line"><span class="cl">crw-rw-rw-r <span class="m">1</span> root root <span class="m">1</span> <span class="m">3</span> June 1, <span class="m">1970</span> null
</span></span><span class="line"><span class="cl">character device file   major number 1, minor number <span class="m">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ls -l /dev/bon
</span></span><span class="line"><span class="cl">br--r--r-- <span class="m">1</span> root root <span class="m">97</span> <span class="m">0</span> June 1, <span class="m">1970</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">bolck device file   major number 97, minor number <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="44-major-design-issues">4.4 Major Design Issues</h3>
<blockquote>
<p>OS/Device Driver Communication
Device Driver/Hardware Communication</p>
</blockquote>
<p><strong>Device Driver Operations</strong></p>
<ul>
<li>Interpret commands received from OS</li>
<li>Schedule multiple requests for services</li>
<li>Manage data transfer across both interfaces</li>
<li>Accept &amp; process hardware interrupts</li>
<li>Maintain the integrity of the device&rsquo;s and kernel&rsquo;s data structures</li>
</ul>
<hr>
<h3 id="45-types-of-device-drivers">4.5 Types of Device Drivers</h3>
<blockquote>
<p>Differences in the way that device drivers communicate with Linux</p>
</blockquote>
<ul>
<li>Block</li>
<li>Character</li>
<li>Network</li>
</ul>
<h4 id="451-block-device-driver">4.5.1 Block Device Driver</h4>
<ul>
<li>Communicate with the OS through a collection of fixed size buffers</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/4_4.png"
        data-srcset="./pic/4_4.png, ./pic/4_4.png 1.5x, ./pic/4_4.png 2x"
        data-sizes="auto"
        alt="./pic/4_4.png"
        title="./pic/4_4.png" /></p>
<ul>
<li>OS manages a <strong>buffer cache</strong>; <strong>satisfy user requests</strong> for data by accessing buffers in the cache.</li>
<li>Driver is invoked when <strong>requested data</strong> is <strong>NOT</strong> <strong>in the cache</strong>; when buffers in the cache have been changed and must be written out (<strong>write back</strong> to the devices).</li>
<li>By using buffer cache, <strong>block drivers</strong> are <strong>insuxlated</strong> from the many details of user requests; only need to handle requests from the OS to fill or empty fixed size buffers.</li>
<li>Many support devices contain file system</li>
</ul>
<hr>
<h4 id="452-character-device-driver">4.5.2 Character Device Driver</h4>
<blockquote>
<p>handle <strong>I/O requests of arbitrary size</strong>; support almost any type of devices.</p>
</blockquote>
<ul>
<li>Handel data a byte at a time(keyboard);</li>
<li>or work best with data in chunks smaller or larger than the standard fixed size buffer used by device driver (e.g. ADC)</li>
</ul>
<p><em>[Communication structure]</em>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/4_5.png"
        data-srcset="./pic/4_5.png, ./pic/4_5.png 1.5x, ./pic/4_5.png 2x"
        data-sizes="auto"
        alt="./pic/4_5.png"
        title="./pic/4_5.png" /></p>
<p><strong>Difference between block &amp; character deivers</strong></p>
<ul>
<li>Block driver – <strong>only</strong> interacts with <strong>buffer cache</strong></li>
<li>Character driver – <strong>directly</strong> interacts with <strong>user requests from user processes</strong>
<ul>
<li>I/O requests are directly passed (essentially unchanged) to the drivers from the user processes</li>
<li>Character driver is responsible for transferring data directly to/from the kernel memory space and the user memory space.</li>
</ul>
</li>
</ul>
<hr>
<h4 id="453-general-programming-considerations">4.5.3 General Programming Considerations</h4>
<ul>
<li>Device drivers are <strong>parts of the kernel</strong> and <strong>not normal user processes</strong>, which means we can only use the kernel <strong>routines</strong> in device driver programs, particularly C library functions or system calls for user level cannot be used.</li>
<li>Some kernel routines may have the same names as C library functions, but they are of totally different implementations.</li>
<li>Make frugal use of <strong>stack</strong> (local arrays &amp; recursive function calls), as the stack space in the kernel is limited and not expandable.</li>
<li>Be aware of floating-point arithmetic: may cause incorrect results</li>
<li>Be aware of busy wait: may lock up the whole system</li>
</ul>
<hr>
<h3 id="summary">Summary</h3>
<p>A device driver is a computer program that glues OS and its I/O devices together.</p>
<p>A device is treated as a special file in Unix.</p>
<p>There are three types of device drivers in Linux based on the different communication manner between device drivers and OS: block, character, and network.</p>
<hr>
<h2 id="5-character-device-driver-development">5 Character Device Driver Development</h2>
<blockquote>
<p>two generic interfaces are related to character device driver development</p>
</blockquote>
<ul>
<li>User programs: devices are treated as special files and users can only access devices through file operation <strong>system call</strong> (such as open, close, read, write, etc.), just like <strong>accessing regular files</strong>.</li>
<li>Kernel: provides a generic interface and kernel routines for all device drivers to implement functionalities and register functions into the kernel data structures (such as char/block device driver tables).</li>
</ul>
<hr>
<h3 id="51-the-interface-for-user-programs">5.1 The Interface for User Programs</h3>
<ul>
<li>Device are treated as <strong>files</strong>: user programs access devices through file operation system calls.</li>
<li>Each file has an <strong>inode</strong>, and each device driver has a <strong>major number</strong>.</li>
<li>When using a device driver in user programs, we need to create a <strong>special file</strong> by <em>associate</em> its <strong>major number</strong> (driver) with an <strong>inode</strong>, e.g. <code>mknod /dev/lab1 c 251 0</code></li>
</ul>
<hr>
<h3 id="52-device-driver-development">5.2 Device Driver Development</h3>
<p>Two Tasks:</p>
<ol>
<li><strong>Implement</strong> functionalities based on the <strong>generic interface</strong></li>
<li><strong>Register</strong> the device driver into the kernel data structure (the char/block device driver table)</li>
</ol>
<blockquote>
<p>The <strong>major</strong> number is the <strong>ID of a device driver</strong></p>
</blockquote>
<hr>
<h3 id="53-the-generic-interface-for-char-device-driver-in-linux">5.3 The Generic Interface for Char Device Driver in Linux</h3>
<ul>
<li>Data structure called <code>file_operations</code> is defined in <code>&lt;linux/fs.h&gt;</code> . It is basically an <strong>array</strong> of function <strong>pointers</strong>.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">file_operations</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span> <span class="n">owner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="err">…</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">open</span><span class="p">)(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">read</span><span class="p">)(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="kt">loff_t</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">write</span><span class="p">)(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="kt">loff_t</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">release</span><span class="p">)(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="err">…</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>To develop a char driver, we need to implement the corresponding functions for a device based on the above generic interface.</li>
</ul>
<hr>
<h3 id="demo-task-1-1">Demo task 1</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">// Header files include the prototypes of kernel routines and data structures needed in the program 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;linux/config.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/module.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/kernel.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/string.h&gt; </span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;asm/uaccess.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define DEVICE_NAME &#34;comp309_char_lab1&#34;
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">static</span> <span class="kt">char</span> <span class="n">msg</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;Hello World!!!</span><span class="se">\n</span><span class="s">&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">int</span> <span class="n">major</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Use &#34;static&#34;, the effective range of a variable is limited in the file containing it, so we can avoid name pollution. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">int</span> <span class="nf">zili_demo_char1_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">fp</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">MOD_INC_USE_COUNT</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">printk</span><span class="p">(</span><span class="s">&#34;Device &#34;</span> <span class="n">DEVICE_NAME</span> <span class="s">&#34; open.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">zili_demo_char1_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="kt">loff_t</span> <span class="o">*</span><span class="n">position</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">num</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span> <span class="n">num</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="n">num</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">copy_to_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">num</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">int</span> <span class="nf">zili_demo_char1_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span><span class="o">*</span><span class="n">fp</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">MOD_DEC_USE_COUNT</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">  <span class="nf">printk</span><span class="p">(</span><span class="s">&#34;Device &#34;</span> <span class="n">DEVICE_NAME</span> <span class="s">&#34; release.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/5_1.png"
        data-srcset="./pic/5_1.png, ./pic/5_1.png 1.5x, ./pic/5_1.png 2x"
        data-sizes="auto"
        alt="./pic/5_1.png"
        title="./pic/5_1.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/5_2.png"
        data-srcset="./pic/5_2.png, ./pic/5_2.png 1.5x, ./pic/5_2.png 2x"
        data-sizes="auto"
        alt="./pic/5_2.png"
        title="./pic/5_2.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/5_3.png"
        data-srcset="./pic/5_3.png, ./pic/5_3.png 1.5x, ./pic/5_3.png 2x"
        data-sizes="auto"
        alt="./pic/5_3.png"
        title="./pic/5_3.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/5_4.png"
        data-srcset="./pic/5_4.png, ./pic/5_4.png 1.5x, ./pic/5_4.png 2x"
        data-sizes="auto"
        alt="./pic/5_4.png"
        title="./pic/5_4.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;linux/module.h&gt; // no need to write &#34;include/linux/module.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define N_D 10  </span><span class="c1">// at most 10 devices
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define S_N 1   </span><span class="c1">// minor# from 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">static</span> <span class="kt">dev_t</span> <span class="n">devno</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// call when module is load into the kernel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">__init</span> <span class="nf">helloworld_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// call when module is unload from the kernel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">__exit</span> <span class="nf">helloworld_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">module_init</span><span class="p">(</span><span class="n">helloworld_init</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">module_exit</span><span class="p">(</span><span class="n">helloworld_exit</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">MODULE_LICENSE</span><span class="p">(</span><span class="s">&#34;GPL&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&#34;YE Haowen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nf">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&#34;Char Device Driver for helloworld!&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="54-kernel-memory-space-and-user-memory-space">5.4 Kernel Memory Space and User Memory Space</h3>
<ul>
<li>The kernel <strong>virtual memory address</strong> space and user virtual memory address space are separate in Unix.</li>
<li>The resources that <strong>only</strong> kernel can access are also called the &ldquo;<strong>kernel land</strong>&rdquo;, while the resources that the user can access are also called the &ldquo;<strong>user land</strong>&rdquo;.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/5_5.png"
        data-srcset="./pic/5_5.png, ./pic/5_5.png 1.5x, ./pic/5_5.png 2x"
        data-sizes="auto"
        alt="./pic/5_5.png"
        title="./pic/5_5.png" /></p>
<hr>
<ul>
<li>declaration: not only declare, but memory allocation</li>
<li>definition: not only define, but implementation</li>
</ul>
<hr>
<h2 id="6-complier-design">6 Complier Design</h2>
<ul>
<li>Overview of Compiler Construction Syntax and semantics of programming languages; language translation approaches; tasks of a compiler; the compiler process.</li>
<li><strong>Lexical Analysis</strong>: Tasks of lexical analysis; specifying tokens by regular grammars and regular expressions; recognizing tokens by <strong>Finite Automata (FA)</strong>; construction of FA from regular expressions; converting NFA to DFA; simulating DFA.</li>
<li><strong>Syntax Analysis</strong>: Tasks of syntax analysis; specifying language constructs by context-free grammars; BNF; derivation; parse and syntax trees; recognizing language constructs by Pushdown Automata; top-down and bottom-up parsing methods.</li>
<li><strong>Code Generation</strong>: Intermediate compilation phases; symbol table; intermediate code generation; code optimisation; code generation.</li>
</ul>
<hr>
<h3 id="61-complier-overview">6.1 Complier Overview</h3>
<blockquote>
<p>Complier: A well-established discipline</p>
</blockquote>
<ul>
<li>Programming languages: high-level vs. low-level</li>
<li>Complier</li>
<li>Phases of a complier</li>
</ul>
<hr>
<p><strong>Programming Languages: Machine Language</strong></p>
<blockquote>
<p>Everything is a binary number: operation, data, address</p>
</blockquote>
<ul>
<li>In MIPS 2000:
<ul>
<li><code>0010 0100 1010 0110 0000 0000 0000 0100</code></li>
<li>means <code>$t5 + 4 -&gt; $6</code></li>
</ul>
</li>
</ul>
<p><strong>Programming Languages: Assembly Language</strong></p>
<ul>
<li>Symbolic representation/mnemonics of machine language
<ul>
<li><code>add $t6, $t5, 4</code></li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_1.png"
        data-srcset="./pic/6_1.png, ./pic/6_1.png 1.5x, ./pic/6_1.png 2x"
        data-sizes="auto"
        alt="./pic/6_1.png"
        title="./pic/6_1.png" /></p>
<p><strong>Benefit of High-level Language</strong></p>
<ul>
<li>human readable</li>
<li>Hide unnecessary details, so have a higher level of abstraction, increased productivity</li>
<li>Make programs more robust: information is specified before its use, enabling subsequent error checking at compile time</li>
<li>Make programs portable: the same program can be compiled on different machines</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_2.png"
        data-srcset="./pic/6_2.png, ./pic/6_2.png 1.5x, ./pic/6_2.png 2x"
        data-sizes="auto"
        alt="./pic/6_2.png"
        title="./pic/6_2.png" /></p>
<hr>
<h3 id="62-translation-mechanism">6.2 Translation Mechanism</h3>
<ul>
<li><strong>Development time</strong> translation: <strong>Compilation</strong>
<ul>
<li>Translate source programs in one language into executable programs</li>
<li>C, C++</li>
</ul>
</li>
<li><strong>Runtime translation</strong>: <strong>Inerpretation</strong>
<ul>
<li>Read source programs, understand and produce execution results in the meantime</li>
<li>line by line</li>
<li>Perl, Shell commands</li>
</ul>
</li>
<li><strong>Hybrid</strong>: <strong>Compilation + Interpretation</strong>
<ul>
<li>Java, complied into byte code, and then interpreted by JVM during runtime</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_3.png"
        data-srcset="./pic/6_3.png, ./pic/6_3.png 1.5x, ./pic/6_3.png 2x"
        data-sizes="auto"
        alt="./pic/6_3.png"
        title="./pic/6_3.png" /></p>
<hr>
<h3 id="63-complier-and-phases-of-a-compliation">6.3 Complier and Phases of a Compliation</h3>
<p><strong>Definition</strong></p>
<ul>
<li>A <strong>compiler</strong> is a software that takes a program written in one language (called the <strong>source language</strong>) and translates it into another (usually equivalent) program in another language (called the <strong>target language</strong>).</li>
<li>Also reports errors (<strong>bugs</strong>) in the source program.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_4.png"
        data-srcset="./pic/6_4.png, ./pic/6_4.png 1.5x, ./pic/6_4.png 2x"
        data-sizes="auto"
        alt="./pic/6_4.png"
        title="./pic/6_4.png" /></p>
<p><em>[Phases of a Compliation]</em>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_5.png"
        data-srcset="./pic/6_5.png, ./pic/6_5.png 1.5x, ./pic/6_5.png 2x"
        data-sizes="auto"
        alt="./pic/6_5.png"
        title="./pic/6_5.png" /></p>
<hr>
<h4 id="631-lexical-analysis">6.3.1 Lexical Analysis</h4>
<ul>
<li>Scan the source program and group sequences of characters into tokens.</li>
<li>A <strong>token</strong> is the <strong>smallest</strong> element of a language
<ul>
<li>A group of characters (e.g., a series of alphabetic characters form a keyword; a series of digits form a number).</li>
</ul>
</li>
<li>The sub-module of the compiler that performs lexical analysis is called a lexical analyzer.</li>
<li>Example: <code>position := initial + rate * 60</code></li>
<li>Read one by one</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_6.png"
        data-srcset="./pic/6_6.png, ./pic/6_6.png 1.5x, ./pic/6_6.png 2x"
        data-sizes="auto"
        alt="./pic/6_6.png"
        title="./pic/6_6.png" /></p>
<hr>
<h4 id="632-syntax-analysis">6.3.2 Syntax Analysis</h4>
<ul>
<li>Once the tokens are identified, syntax analysis groups sequences of tokens into language constructs.
<ul>
<li>e.g., identifiers, numbers, and operators can be grouped into expressions.</li>
<li>e.g., keywords, identifiers, expressions, and operators can be combined to form statements.</li>
</ul>
</li>
<li>The sub-module of the compiler that performs syntax analysis is called the parser/syntax analyzer.</li>
</ul>
<hr>
<h5 id="633-syntaxparse-tree">6.3.3 Syntax(Parse) Tree</h5>
<ul>
<li>Result of syntax analysis is recorded in a hierarchical structure called a syntax tree.
<ul>
<li>Each node represents an operation and its children represent the arguments of the operation.</li>
<li>Evaluation begins from bottom and moves up.</li>
<li>E.g., parse tree for <code>position := initial + rate * 60</code></li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_7.png"
        data-srcset="./pic/6_7.png, ./pic/6_7.png 1.5x, ./pic/6_7.png 2x"
        data-sizes="auto"
        alt="./pic/6_7.png"
        title="./pic/6_7.png" /></p>
<hr>
<h4 id="634-semantic-analysis">6.3.4 Semantic Analysis</h4>
<ul>
<li>Put semantic meaning into the syntax tree:
<ul>
<li>syntax analysis recognizes grammatical events;</li>
<li>semantic analysis processes such events, e.g., type checking, or triggering corresponding intermediate code generation</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_8.png"
        data-srcset="./pic/6_8.png, ./pic/6_8.png 1.5x, ./pic/6_8.png 2x"
        data-sizes="auto"
        alt="./pic/6_8.png"
        title="./pic/6_8.png" /></p>
<hr>
<h4 id="635-intermediate-code-generation">6.3.5 Intermediate Code Generation</h4>
<ul>
<li>Generate IR (Intermediate Representation) code:</li>
<li>Easier to generate machine code from IR code.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_9.png"
        data-srcset="./pic/6_9.png, ./pic/6_9.png 1.5x, ./pic/6_9.png 2x"
        data-sizes="auto"
        alt="./pic/6_9.png"
        title="./pic/6_9.png" /></p>
<hr>
<h4 id="636-code-optimization">6.3.6 Code Optimization</h4>
<ul>
<li>Modify program representation so that program can run faster, use less memory, power, etc.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_10.png"
        data-srcset="./pic/6_10.png, ./pic/6_10.png 1.5x, ./pic/6_10.png 2x"
        data-sizes="auto"
        alt="./pic/6_10.png"
        title="./pic/6_10.png" /></p>
<hr>
<h4 id="637-code-generation">6.3.7 Code Generation</h4>
<ul>
<li>Generate the target program</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_11.png"
        data-srcset="./pic/6_11.png, ./pic/6_11.png 1.5x, ./pic/6_11.png 2x"
        data-sizes="auto"
        alt="./pic/6_11.png"
        title="./pic/6_11.png" /></p>
<hr>
<h4 id="638-distinction-between-phases-and-passes">6.3.8 Distinction between Phases and Passes</h4>
<ul>
<li>Passes: the times going through a program representation.
<ul>
<li>1-pass, 2-pass, multiple-pass compliation</li>
<li>Language become more complex – more passes</li>
</ul>
</li>
<li>Phases: conceptual stages, or modules of the compiler
<ul>
<li>Not completely separate: Semantic phase may do things that syntax should do</li>
</ul>
</li>
</ul>
<hr>
<h3 id="64-lexical-analysisi">6.4 Lexical Analysis(I)</h3>
<ul>
<li>Why we need lexical analysis? Its input and output.</li>
<li>How to specify tokens: Regular Expression</li>
<li>How to recognize tokens – two methods</li>
<li>Regular Expression $\to$ Lex (software tool)</li>
<li>Regular Expression $\to$ Finite Automata</li>
</ul>
<hr>
<p><strong>Why need Lexical Analysis?</strong></p>
<ul>
<li>Group the character into meaningful words</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_12.png"
        data-srcset="./pic/6_12.png, ./pic/6_12.png 1.5x, ./pic/6_12.png 2x"
        data-sizes="auto"
        alt="./pic/6_12.png"
        title="./pic/6_12.png" /></p>
<h4 id="641-input-and-output-of-lexical-analysis">6.4.1 Input and Output of Lexical Analysis</h4>
<p>In lexical analysis, a source program is read from <strong>left-to-right</strong> and grouped into <strong>tokens</strong>. A token is a sequence of characters with a collective meaning.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_13.png"
        data-srcset="./pic/6_13.png, ./pic/6_13.png 1.5x, ./pic/6_13.png 2x"
        data-sizes="auto"
        alt="./pic/6_13.png"
        title="./pic/6_13.png" /></p>
<p><strong>Token</strong></p>
<ul>
<li>A syntactic category
<ul>
<li>In English: a noun, a verb, an adjective, …</li>
<li>In a programming language: an <strong>identifier</strong>, an <strong>integer value</strong>, a <strong>keyword</strong>, a <strong>white space</strong>, …</li>
</ul>
</li>
<li>Tokens correspond to sets of strings with a collective meaning
<ul>
<li>Identifier: strings of letters and digits, starting with a letter</li>
<li>Integer value: a non-empty string of digits</li>
<li>Keyword: <code>else</code>, <code>if</code>, <code>where</code>, …</li>
</ul>
</li>
</ul>
<p><em>[Expression]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_14.png"
        data-srcset="./pic/6_14.png, ./pic/6_14.png 1.5x, ./pic/6_14.png 2x"
        data-sizes="auto"
        alt="./pic/6_14.png"
        title="./pic/6_14.png" /></p>
<p><em>[Mini Program]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_15.png"
        data-srcset="./pic/6_15.png, ./pic/6_15.png 1.5x, ./pic/6_15.png 2x"
        data-sizes="auto"
        alt="./pic/6_15.png"
        title="./pic/6_15.png" /></p>
<p><strong>Reason for tokens</strong></p>
<ul>
<li>Classify program substrings according to their syntactic role.</li>
<li>As the output of lexical analysis, <strong>tokens</strong> are the <strong>input</strong> to the <strong>parser</strong> (<strong>syntax analysis</strong>)
<ul>
<li>Parser relies on token distinctions</li>
<li>Different tokens are treated differently by the parser(keyword vs. identifier)</li>
</ul>
</li>
</ul>
<p><strong>Recognize tokens</strong></p>
<ul>
<li>First, specify tokens using <strong>regular expressions</strong> (patterns)</li>
<li>Second, based on regular expression, two ways to implement a lexical analyzer:
<ul>
<li>Method 1: use <strong>Lex</strong>, a software tool</li>
<li>Method 2: use finite automata (write your own program)</li>
</ul>
</li>
</ul>
<hr>
<h3 id="65-lexical-analysisii">6.5 Lexical Analysis(II)</h3>
<ul>
<li>Part II: Regular Expression</li>
</ul>
<hr>
<h4 id="651-regular-expression">6.5.1 Regular Expression</h4>
<p><strong>Specify tokens</strong></p>
<ul>
<li>A token is specified by a <strong>pattern</strong>: a set of <strong>rules</strong> that describe the <strong>formation</strong> of the token</li>
<li>The lexical analyzer uses the pattern to identify the <strong>lexeme</strong>: a sequence of characters in the input that matches the pattern. Once matched, the corresponding token is recognized.</li>
<li>For example: The <strong>rule</strong> (<strong>pattern</strong>) for identifier: letter followed by letters and digits
<ul>
<li><code>abc1</code> and <code>A1By</code> match the rule (pattern), hence they are identifier tokens;</li>
<li><code>1A</code> does not match the rule (pattern), hence it is not an identifier token.</li>
</ul>
</li>
</ul>
<blockquote>
<p>The rules for specifying token patterns are called regular expression.
A <strong>regular set</strong> (<strong>regular language</strong>) is the set of strings generated by a <strong>regular expression</strong> over an <strong>alphabet</strong>.</p>
</blockquote>
<hr>
<h4 id="652-alphabet-and-strings">6.5.2 Alphabet and Strings</h4>
<ul>
<li>An <strong>alphabet</strong> (usually denoted as $\sum$) is a <strong>finite</strong> set of symbols.
<ul>
<li>E.g. ${0,1}$ is the binary digits alphabet; ${a,b,c}$ is the English letter alphabet.</li>
</ul>
</li>
<li>A <strong>string</strong> $s$ over an alphabet $\sum$ is a finite sequence of symbols drawn from that alphabet.
<ul>
<li>E.g. <code>01001</code> is the string over $\sum_{\text{bin_digits}}$ $= {0,1}$</li>
<li><code>wxyasd</code> is the string over $\sum_{\text{lower_case_letters}}$ $= {a,b,&hellip;,z}$</li>
<li>$ε$ is the <strong>empty string</strong> (without any symbol)</li>
</ul>
</li>
<li>The <strong>length</strong> of a string $s$ is denoted as $|s|$. E.g. $|ε|$ = 0; $|101| = 3$; $|abcdef| = 6$.</li>
</ul>
<hr>
<h4 id="653-kleene-closure-and-language">6.5.3 Kleene Closure and Language</h4>
<ul>
<li>The Kleene closure of alphabet Σ, denoted as Σ∗, is the set of all strings, including the empty string  , over the alphabet Σ.
<ul>
<li>E.g. given alphabet Σ = {0,1}, then Σ∗ = {ε,0,1,00,01,10,11,000,001,&hellip;.}</li>
</ul>
</li>
<li>Any set of strings over an alphabet Σ, i.e. any subset of Σ∗, is called a <strong>language</strong>.
<ul>
<li>E.g. the empty set ∅, { }, Σ, and Σ∗ are all languages; abc, Def, D, z is a language over Σ letters = a, b, … , z, A, B, … , Z .</li>
</ul>
</li>
</ul>
<hr>
<h4 id="654-operations-on-languages">6.5.4 Operations on languages</h4>
<ul>
<li>Particularly <strong>union</strong>, <strong>concatenation</strong>, <strong>Kleene closure</strong>, and <strong>positive closure</strong>.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_16.png"
        data-srcset="./pic/6_16.png, ./pic/6_16.png 1.5x, ./pic/6_16.png 2x"
        data-sizes="auto"
        alt="./pic/6_16.png"
        title="./pic/6_16.png" /></p>
<p><strong>Precedence</strong></p>
<ul>
<li>Kleene closure $\succ$ concatenation $\succ$ union
<ul>
<li>{1}|{2}{3}*</li>
</ul>
</li>
<li>Exponentiation (concatenating the same language) ≻ multiplication (concatenating different/same languages) ≻ addition (union)
<ul>
<li>{1} + {2} $\cdot$ {3}^2.</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_17.png"
        data-srcset="./pic/6_17.png, ./pic/6_17.png 1.5x, ./pic/6_17.png 2x"
        data-sizes="auto"
        alt="./pic/6_17.png"
        title="./pic/6_17.png" /></p>
<p>Let $L={a,b,&hellip;,z,A,B,&hellip;,Z}$ and $D={0,1,2,&hellip;,9}$</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_18.png"
        data-srcset="./pic/6_18.png, ./pic/6_18.png 1.5x, ./pic/6_18.png 2x"
        data-sizes="auto"
        alt="./pic/6_18.png"
        title="./pic/6_18.png" /></p>
<hr>
<h4 id="656-reaular-expressions">6.5.6 Reaular Expressions</h4>
<p>Let $\sum = {a,b}$</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_19.png"
        data-srcset="./pic/6_19.png, ./pic/6_19.png 1.5x, ./pic/6_19.png 2x"
        data-sizes="auto"
        alt="./pic/6_19.png"
        title="./pic/6_19.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_20.png"
        data-srcset="./pic/6_20.png, ./pic/6_20.png 1.5x, ./pic/6_20.png 2x"
        data-sizes="auto"
        alt="./pic/6_20.png"
        title="./pic/6_20.png" /></p>
<hr>
<h4 id="657-identifiers-in-pascal">6.5.7 Identifiers in Pascal</h4>
<ul>
<li>Pascal identifier: a string of letters and digits beginning with a letter.</li>
<li>Regular definition</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_21.png"
        data-srcset="./pic/6_21.png, ./pic/6_21.png 1.5x, ./pic/6_21.png 2x"
        data-sizes="auto"
        alt="./pic/6_21.png"
        title="./pic/6_21.png" /></p>
<p><em>[Unsigned Numbers in Pascal]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_22.png"
        data-srcset="./pic/6_22.png, ./pic/6_22.png 1.5x, ./pic/6_22.png 2x"
        data-sizes="auto"
        alt="./pic/6_22.png"
        title="./pic/6_22.png" /></p>
<p><em>[Notation Shorthands]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_23.png"
        data-srcset="./pic/6_23.png, ./pic/6_23.png 1.5x, ./pic/6_23.png 2x"
        data-sizes="auto"
        alt="./pic/6_23.png"
        title="./pic/6_23.png" /></p>
<hr>
<h4 id="658-implementation-of-lexical-analyzer">6.5.8 Implementation of Lexical Analyzer</h4>
<ul>
<li>After regular expressions are obtained, we have two methods to implement a lexical analyzer:
<ul>
<li>Use tools: lex (for C), flex (for C/C++), jlex (for Java)
<ul>
<li>Specify tokens using regular expressions</li>
<li>Tool generates source code for the lexical analysis</li>
</ul>
</li>
<li>Use regular expressions and finite automata
<ul>
<li>Write code to express the recognition of tokens</li>
<li>Table drivern</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Lex: a lexical analyzer generator</strong></p>
<blockquote>
<p>Lex is a Unix software tool, automatically constructs a lexical analyzer.</p>
</blockquote>
<ul>
<li>Input: a specification containing regular expressions written in the Lex language.
<ul>
<li>Assumes that each token matches a regular expression.</li>
<li>Need an action specification for each expression.</li>
</ul>
</li>
<li>Output: Produces a C program that can recognize the matching tokens and trigger the specified actions.</li>
<li>Especially useful when coupled with a parser generator</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/6_24.png"
        data-srcset="./pic/6_24.png, ./pic/6_24.png 1.5x, ./pic/6_24.png 2x"
        data-sizes="auto"
        alt="./pic/6_24.png"
        title="./pic/6_24.png" /></p>
<hr>
<h2 id="7-lexical-analysisiii---finite-automata">7 Lexical Analysis(III) - Finite Automata</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_1.png"
        data-srcset="./pic/7_1.png, ./pic/7_1.png 1.5x, ./pic/7_1.png 2x"
        data-sizes="auto"
        alt="./pic/7_1.png"
        title="./pic/7_1.png" /></p>
<h3 id="71-nfa-dfa-and-nfa-to-dfa-conversion">7.1 NFA, DFA, and NFA $\to$ DFA Conversion</h3>
<p><strong>Recognizing Tokens</strong></p>
<ul>
<li>
<p>Regular Expression à Specify tokens</p>
</li>
<li>
<p>Finite Automaton à Recognize tokens</p>
</li>
<li>
<p>A language recognizer:</p>
<ul>
<li>Input: string x $\to_{\test{Recognizer for L}}$ $\to$ Ouputs &ldquo;yes&rdquo; if x $\in$ L, &ldquo;no&rdquo; otherwise</li>
</ul>
</li>
<li>
<p>A recognizer for a language  is a program that takes a string  and answers &ldquo;yes&rdquo; if is a string of , and &ldquo;no&rdquo; otherwise.</p>
</li>
</ul>
<hr>
<h3 id="72-nondeterministic-finite-automata-nfa">7.2 Nondeterministic Finite Automata (NFA)</h3>
<ul>
<li>A Nondeterministic Finite Automaton (NFA) consists of 5 components (Σ,S,S_0,F,move).
<ul>
<li>Σ is the <strong>input alphabet</strong></li>
<li>S is the set of <strong>states</strong></li>
<li>S_0 is the <strong>start state</strong></li>
<li>F $\subset$ S is the set of <strong>accepting states</strong></li>
<li><strong>move</strong> is the <strong>transition function</strong> that maps state-symbol pairs to sets of states.</li>
</ul>
</li>
</ul>
<p><strong>Transition Graphs</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_2.png"
        data-srcset="./pic/7_2.png, ./pic/7_2.png 1.5x, ./pic/7_2.png 2x"
        data-sizes="auto"
        alt="./pic/7_2.png"
        title="./pic/7_2.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_3.png"
        data-srcset="./pic/7_3.png, ./pic/7_3.png 1.5x, ./pic/7_3.png 2x"
        data-sizes="auto"
        alt="./pic/7_3.png"
        title="./pic/7_3.png" /></p>
<hr>
<h3 id="73-state-transition-table">7.3 State Transition Table</h3>
<p>The transition function of an NFA can also be implemented by a <strong>transition table</strong>, where the entries of rows are states and columns, respectively.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_4.png"
        data-srcset="./pic/7_4.png, ./pic/7_4.png 1.5x, ./pic/7_4.png 2x"
        data-sizes="auto"
        alt="./pic/7_4.png"
        title="./pic/7_4.png" /></p>
<hr>
<h3 id="74-ε---transition">7.4 ε - Transition</h3>
<p>A nother kind of transition, where the automaton transits from one state to another state without reading any input.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_5.png"
        data-srcset="./pic/7_5.png, ./pic/7_5.png 1.5x, ./pic/7_5.png 2x"
        data-sizes="auto"
        alt="./pic/7_5.png"
        title="./pic/7_5.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_6.png"
        data-srcset="./pic/7_6.png, ./pic/7_6.png 1.5x, ./pic/7_6.png 2x"
        data-sizes="auto"
        alt="./pic/7_6.png"
        title="./pic/7_6.png" /></p>
<ul>
<li>NFA based recognitions (decisions) are hard to implement</li>
<li>Can have multiple transitions from one input in a given state</li>
<li>Can have ε-transitions Easy to form from regular expressions</li>
<li>Hard to implement the recognition (decision) algorithm</li>
</ul>
<hr>
<h3 id="75-deterministic-finite-automata">7.5 Deterministic Finite Automata</h3>
<blockquote>
<p>A DFA is a special case of NFA:</p>
<blockquote>
<p>One transition per input per state
No ε-transitions</p>
</blockquote>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_7.png"
        data-srcset="./pic/7_7.png, ./pic/7_7.png 1.5x, ./pic/7_7.png 2x"
        data-sizes="auto"
        alt="./pic/7_7.png"
        title="./pic/7_7.png" /></p>
<p><strong>Examples of NFA and DFA Given alphabet</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_8.png"
        data-srcset="./pic/7_8.png, ./pic/7_8.png 1.5x, ./pic/7_8.png 2x"
        data-sizes="auto"
        alt="./pic/7_8.png"
        title="./pic/7_8.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_9.png"
        data-srcset="./pic/7_9.png, ./pic/7_9.png 1.5x, ./pic/7_9.png 2x"
        data-sizes="auto"
        alt="./pic/7_9.png"
        title="./pic/7_9.png" /></p>
<ul>
<li>NFA:
<ul>
<li>Easy to generate strings.</li>
<li>May go to anyone of several states given an input symbol.</li>
<li>May go to another state when there is no input, due to  -transition(s).</li>
</ul>
</li>
<li>DFA:
<ul>
<li>Easy to both generate and recognize strings.</li>
<li>Goes to only one deterministic state given an input symbol.</li>
<li>Does not go anywhere when there is no input; does not have any  ε-transition.</li>
</ul>
</li>
</ul>
<p><strong>Table Implementation of DFA</strong>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_10.png"
        data-srcset="./pic/7_10.png, ./pic/7_10.png 1.5x, ./pic/7_10.png 2x"
        data-sizes="auto"
        alt="./pic/7_10.png"
        title="./pic/7_10.png" /></p>
<hr>
<h3 id="76-algorithm-simulating-a-dfa">7.6 Algorithm: Simulating a DFA</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_11.png"
        data-srcset="./pic/7_11.png, ./pic/7_11.png 1.5x, ./pic/7_11.png 2x"
        data-sizes="auto"
        alt="./pic/7_11.png"
        title="./pic/7_11.png" /></p>
<hr>
<h3 id="77-regular-expression-to-nfa">7.7 Regular Expression to NFA</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_12.png"
        data-srcset="./pic/7_12.png, ./pic/7_12.png 1.5x, ./pic/7_12.png 2x"
        data-sizes="auto"
        alt="./pic/7_12.png"
        title="./pic/7_12.png" /></p>
<p><em>[Break Regular Expression to NFA]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_13.png"
        data-srcset="./pic/7_13.png, ./pic/7_13.png 1.5x, ./pic/7_13.png 2x"
        data-sizes="auto"
        alt="./pic/7_13.png"
        title="./pic/7_13.png" /></p>
<p><strong>NFA to DFA</strong></p>
<ul>
<li>
<p>A DFA is a special case of NFA. The conversion of an NFA to a DFA needs to meet the two requirements on DFA:</p>
<ul>
<li>-closure(s): the set of all states reachable from  on  -transition (to meet the no ε-transition requirement of DFA).</li>
<li>Regard all reachable states from one state on one input symbol as one state (to meet the one transition per input per state requirement of DFA).</li>
</ul>
</li>
<li>
<p>Conversion Algorithm</p>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_14.png"
        data-srcset="./pic/7_14.png, ./pic/7_14.png 1.5x, ./pic/7_14.png 2x"
        data-sizes="auto"
        alt="./pic/7_14.png"
        title="./pic/7_14.png" /></p>
<ul>
<li>States of DFA obtained from NFA
<ul>
<li>An NFA may be in many states at any time.</li>
<li>If there are  states, the NFA must be in some subset of those  states.</li>
<li>Given a set of  elements, it has $2^N$ subsets.</li>
<li>The DFA can have at the most $2^N$ states, where is the number of states of the NFA.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="78-regular-expression-to-nfa">7.8 Regular Expression to NFA</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_15.png"
        data-srcset="./pic/7_15.png, ./pic/7_15.png 1.5x, ./pic/7_15.png 2x"
        data-sizes="auto"
        alt="./pic/7_15.png"
        title="./pic/7_15.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/7_16.png"
        data-srcset="./pic/7_16.png, ./pic/7_16.png 1.5x, ./pic/7_16.png 2x"
        data-sizes="auto"
        alt="./pic/7_16.png"
        title="./pic/7_16.png" /></p>
<hr>
<h2 id="8-syntax-analysis">8 Syntax Analysis</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_1.png"
        data-srcset="./pic/8_1.png, ./pic/8_1.png 1.5x, ./pic/8_1.png 2x"
        data-sizes="auto"
        alt="./pic/8_1.png"
        title="./pic/8_1.png" /></p>
<h3 id="81-introduction">8.1 Introduction</h3>
<ul>
<li>Input: sequence of <strong>tokens</strong> from lexical analysiss</li>
<li>Output: a <strong>parse tree</strong> (<strong>syntax tree</strong>) based on the <strong>gsrammar</strong> of a programming language.</li>
</ul>
<p><em>[Comparison between Lexical and Syntax]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_2.png"
        data-srcset="./pic/8_2.png, ./pic/8_2.png 1.5x, ./pic/8_2.png 2x"
        data-sizes="auto"
        alt="./pic/8_2.png"
        title="./pic/8_2.png" /></p>
<p><em>[Example]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_3.png"
        data-srcset="./pic/8_3.png, ./pic/8_3.png 1.5x, ./pic/8_3.png 2x"
        data-sizes="auto"
        alt="./pic/8_3.png"
        title="./pic/8_3.png" /></p>
<hr>
<p><strong>Syntax and Grammar</strong></p>
<ul>
<li>In Pascal, program à blocks; block à statements; …</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">var a,b,c;
</span></span><span class="line"><span class="cl">begin
</span></span><span class="line"><span class="cl">  a = b+c;
</span></span><span class="line"><span class="cl">end
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The syntax of programming language constructs can be described by <strong>context-free grammar</strong> (<strong>CFG</strong>).</li>
</ul>
<hr>
<h3 id="82-context-free-grammar">8.2 Context-Free Grammar</h3>
<ul>
<li>$ G= (N,T,S,P)$
<ul>
<li>$N$ is a finite set of <strong>nonterminal</strong> symbols (simplified as &ldquo;nonterminals&rdquo;);</li>
<li>$T$ is a finite set of <strong>terminal</strong> symbols (simplified as &ldquo;terminals&rdquo;);</li>
<li>$S$ is the unique <strong>start nonterminal</strong>($S\in N$);</li>
<li>$P$ is a finite set of <strong>productions</strong>. Every production in $P$ is of the form $A \to \beta$, where $A \in N$ and $\beta \in (N \cup T)^*$.</li>
<li>e.g., $N = {S}$, $T = {a,b}$, $S,P = {S \to aSb|ab}$, where $S \to aSb|ab$ denotes the language $L = {a^nb^n|n \geq 0}$.</li>
</ul>
</li>
</ul>
<p><strong>Not Regular Expression</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_4.png"
        data-srcset="./pic/8_4.png, ./pic/8_4.png 1.5x, ./pic/8_4.png 2x"
        data-sizes="auto"
        alt="./pic/8_4.png"
        title="./pic/8_4.png" /></p>
<p><strong>Regular Expression, CFG, and Automata</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_5.png"
        data-srcset="./pic/8_5.png, ./pic/8_5.png 1.5x, ./pic/8_5.png 2x"
        data-sizes="auto"
        alt="./pic/8_5.png"
        title="./pic/8_5.png" /></p>
<p><strong>Language Classfication</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_6.png"
        data-srcset="./pic/8_6.png, ./pic/8_6.png 1.5x, ./pic/8_6.png 2x"
        data-sizes="auto"
        alt="./pic/8_6.png"
        title="./pic/8_6.png" /></p>
<hr>
<p><strong>Regular Expression vs. CFG</strong></p>
<ul>
<li>Every language that can be described by a regular expression can also be described by a CFG
<ul>
<li>e.g., $(a|b)^*abb$</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_7.png"
        data-srcset="./pic/8_7.png, ./pic/8_7.png 1.5x, ./pic/8_7.png 2x"
        data-sizes="auto"
        alt="./pic/8_7.png"
        title="./pic/8_7.png" /></p>
<p><strong>Derivations, Language of a CFG</strong></p>
<ul>
<li>Based on a grammar for a language, we can generate <strong>sentences</strong> (strings consisting only of terminals) of the language. This is done by <strong>derivations</strong>. For CFG, derivation means start from the start nonterminal, repeatedly use productions to replace nonterminals, until a sentence is produced (i.e. all nonterminals are replaced).
<ul>
<li>Grammar: $S \to aSb|ab$</li>
<li>Derivation: $S \Rightarrow aSb \Rightarrow aaSbb \Rightarrow aabbb$</li>
<li>where $\Rightarrow$ means &ldquo;derives in one step&rdquo;</li>
</ul>
</li>
<li>A <strong>CFG</strong> language is the set of all the <strong>sentences</strong> that can be derived from the start symbol of the CFG grammar.</li>
<li>The <strong>reverse</strong> is <strong>syntax analysis (parsing)</strong>: given an input string of terminals, is there a derivation for the string based on the grammar (is the string a sentence of the grammar)?</li>
</ul>
<p><strong>Parse Tree, Leftmost/Rightmost Derivation</strong></p>
<ul>
<li>For CFG, a <strong>parse tree</strong> is a tree with the following properties
<ul>
<li>The <strong>root</strong> is labeled by the <strong>start</strong> nonterminal;</li>
<li>Each <strong>leaf</strong> node is labeled by a <strong>terminal</strong> or by ;</li>
<li>An <strong>interior node</strong> is labeled by a <strong>nonterminal</strong>;</li>
<li>If A is the nonterminal labeling some interior node, and $X_1X_2&hellip;X_n$ are the labels of the children of that node from left to right, then $A \to X_1X_2&hellip;X_n$ is a production.</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_8.png"
        data-srcset="./pic/8_8.png, ./pic/8_8.png 1.5x, ./pic/8_8.png 2x"
        data-sizes="auto"
        alt="./pic/8_8.png"
        title="./pic/8_8.png" /></p>
<ul>
<li>A  string of terminals is a sentence of a CFG grammar iff there is a (can have more) parse tree for this string. The derivation of the sentence can be shown pictorially by this parse tree.</li>
<li>Suppose the parse tree of the sentence is found.
<ul>
<li>Leftmost derivation: only the leftmost nonterminal is replaced at each derivation step.</li>
<li>E.g., grammar: $E \to E+E|E*E|(E)|id$</li>
<li>Leftmost derivation: $E \Rightarrow -E \Rightarrow -(E+E) \Rightarrow -(id+E) \Rightarrow -(id+id)$</li>
</ul>
</li>
<li>Similarly, for <strong>rightmost derivation</strong>, the rightmost nonterminal is replaced at each step.</li>
</ul>
<hr>
<h3 id="83-parsing-methods">8.3 Parsing Methods</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_9.png"
        data-srcset="./pic/8_9.png, ./pic/8_9.png 1.5x, ./pic/8_9.png 2x"
        data-sizes="auto"
        alt="./pic/8_9.png"
        title="./pic/8_9.png" /></p>
<h4 id="831-bottom-up-parsing">8.3.1 Bottom-Up Parsing</h4>
<ul>
<li>Start at the <strong>leaves</strong> and build the parse tree from bottom up.</li>
<li>Basic method: <strong>shift-reduce</strong>
<ul>
<li>Shift symbols onto the stack;</li>
<li>Reduce when handle is identified by left side.</li>
<li>Used to implement automatic parser generator such as Yacc.</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_10.png"
        data-srcset="./pic/8_10.png, ./pic/8_10.png 1.5x, ./pic/8_10.png 2x"
        data-sizes="auto"
        alt="./pic/8_10.png"
        title="./pic/8_10.png" /></p>
<p><strong>Shift-reduce Parser</strong></p>
<ul>
<li>Two data structures:
<ul>
<li>A <strong>Stack</strong> to hold the grammar symbols;</li>
<li>An <strong>Input buffer</strong> to hold the string to be parsed;</li>
<li>Stack contains only <code>$</code> symbol;</li>
<li>Input buffer contains input string followed by <code>$</code> symbol.</li>
</ul>
</li>
<li>Possible actions:
<ul>
<li><strong>Shift</strong>: move the next input symbol to the top of the stack;</li>
<li><strong>Reduce</strong>: replace the top of the stack with the appropriate non-terminal symbol ;</li>
<li><strong>Accept</strong>: parser reports the successsful completion of parsing;</li>
<li><strong>Error</strong>: parser is confused and is not able to make any decision. It can <strong>neither</strong> perform <strong>shift</strong> action <em>nor</em> <strong>reduce</strong> action <em>nor</em> <strong>accept</strong> action.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Important rules:
If the priority of incoming operator is more than the priority of in stack operator, then shift action is performed.
If the priority of in stack operator is same or less than the priority of in stack operator, then reduce action is performed.</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_11.png"
        data-srcset="./pic/8_11.png, ./pic/8_11.png 1.5x, ./pic/8_11.png 2x"
        data-sizes="auto"
        alt="./pic/8_11.png"
        title="./pic/8_11.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_12.png"
        data-srcset="./pic/8_12.png, ./pic/8_12.png 1.5x, ./pic/8_12.png 2x"
        data-sizes="auto"
        alt="./pic/8_12.png"
        title="./pic/8_12.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_13.png"
        data-srcset="./pic/8_13.png, ./pic/8_13.png 1.5x, ./pic/8_13.png 2x"
        data-sizes="auto"
        alt="./pic/8_13.png"
        title="./pic/8_13.png" /></p>
<hr>
<h4 id="832-top-down-parsing">8.3.2 Top-Down Parsing</h4>
<ul>
<li><strong>Start</strong> at the <strong>root</strong> of the parse tree and try to get to leaves. Can be efficiently written by hand.</li>
<li>Only work for certain class of grammars:
<ul>
<li>Unambiguous</li>
<li>No left recursion</li>
<li>No left factoring</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Left recursion</strong>: A grammar is left-recursive if and only if there exists a nonterminal symbol  that can derive to a sentential form with itself as the leftmost symbol. That is, $A \Rightarrow^+ A\alpha$, where $\Rightarrow^+$ means the operation of making one or more substitutions, and  is any sequence of terminal and nonterminal symbols.
<strong>Left factoring</strong>: A grammar is left factoring if and only if there exists a nonterminal symbol $A$ that $A$ has $\alpha \beta_1 |\alpha \beta_2 $, where $\alpha, \beta$ are any sequence of terminal and nonterminal symbols, with $\alpha \neq e$ .</p>
</blockquote>
<p><strong>Recursive Production</strong></p>
<ul>
<li>Recursive Production: if the same non-terminal at both left and right hand side of production</li>
</ul>
<p>$$
S \to aSb,
S \to aS,
S \to Sa
$$</p>
<ul>
<li>Recursive Grammar:if at least one recursive production is present</li>
</ul>
<p>$$
S \to aS | a,
S \to Sa|as,
S \to aSb|ab
$$</p>
<hr>
<h4 id="833-convert-left-recursion-into-right-recursion">8.3.3 Convert Left recursion into Right recursion</h4>
<ul>
<li>If a CFG contains left recursion then the compiler may go to infinity loop, hence, to avoid the looping of the compiler, we need to convert the left recursive grammar into its equivalent right recursive production</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_14.png"
        data-srcset="./pic/8_14.png, ./pic/8_14.png 1.5x, ./pic/8_14.png 2x"
        data-sizes="auto"
        alt="./pic/8_14.png"
        title="./pic/8_14.png" /></p>
<p><em>[Examples]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_15.png"
        data-srcset="./pic/8_15.png, ./pic/8_15.png 1.5x, ./pic/8_15.png 2x"
        data-sizes="auto"
        alt="./pic/8_15.png"
        title="./pic/8_15.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_16.png"
        data-srcset="./pic/8_16.png, ./pic/8_16.png 1.5x, ./pic/8_16.png 2x"
        data-sizes="auto"
        alt="./pic/8_16.png"
        title="./pic/8_16.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_17.png"
        data-srcset="./pic/8_17.png, ./pic/8_17.png 1.5x, ./pic/8_17.png 2x"
        data-sizes="auto"
        alt="./pic/8_17.png"
        title="./pic/8_17.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_18.png"
        data-srcset="./pic/8_18.png, ./pic/8_18.png 1.5x, ./pic/8_18.png 2x"
        data-sizes="auto"
        alt="./pic/8_18.png"
        title="./pic/8_18.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_19.png"
        data-srcset="./pic/8_19.png, ./pic/8_19.png 1.5x, ./pic/8_19.png 2x"
        data-sizes="auto"
        alt="./pic/8_19.png"
        title="./pic/8_19.png" /></p>
<hr>
<p><strong>Ambiguous Grammars</strong></p>
<ul>
<li>Each parse tree has a <em><strong>unique</strong></em> <strong>leftmost/rightmost derivation</strong>.</li>
<li>Sometimes a <strong>grammar</strong> may have (produce, imply) <strong>more than one parse tree</strong> for some of its sentences. Such a grammar is said to be <strong>ambiguous</strong>. For such a sentence (i.e., having more than one parse tree), its leftmost and rightmost derivations may be different.
<ul>
<li>e.g., grammar: $E\to E+E|E*E|id$, sntence <code>id+id*id</code></li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_20.png"
        data-srcset="./pic/8_20.png, ./pic/8_20.png 1.5x, ./pic/8_20.png 2x"
        data-sizes="auto"
        alt="./pic/8_20.png"
        title="./pic/8_20.png" /></p>
<ul>
<li>Grammar which is <strong>both</strong> <strong>left</strong> and <strong>right</strong> <strong>recursive</strong> is always ambiguous <em><strong>but</strong></em> ambiguous grammar need not be both left and right recursive</li>
</ul>
<p><em>[Example]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_21.png"
        data-srcset="./pic/8_21.png, ./pic/8_21.png 1.5x, ./pic/8_21.png 2x"
        data-sizes="auto"
        alt="./pic/8_21.png"
        title="./pic/8_21.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_22.png"
        data-srcset="./pic/8_22.png, ./pic/8_22.png 1.5x, ./pic/8_22.png 2x"
        data-sizes="auto"
        alt="./pic/8_22.png"
        title="./pic/8_22.png" /></p>
<hr>
<h4 id="834-non-deteministic-grammar">8.3.4 Non-deteministic Grammar</h4>
<ul>
<li>The grammar with common prefix is known as non-deterministic grammar.
<ul>
<li>$A\to \alpha\beta_1, \alpha\beta_2$</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_23.png"
        data-srcset="./pic/8_23.png, ./pic/8_23.png 1.5x, ./pic/8_23.png 2x"
        data-sizes="auto"
        alt="./pic/8_23.png"
        title="./pic/8_23.png" /></p>
<ul>
<li>Grammar with common prefixes requires a lot of Back-tracking, which is time consuming and inefficient.</li>
<li>To avoid the back-tracking, we need to remove the common prefix from the grammar, like convert non-deterministic grammar into deterministic grammar.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_24.png"
        data-srcset="./pic/8_24.png, ./pic/8_24.png 1.5x, ./pic/8_24.png 2x"
        data-sizes="auto"
        alt="./pic/8_24.png"
        title="./pic/8_24.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_25.png"
        data-srcset="./pic/8_25.png, ./pic/8_25.png 1.5x, ./pic/8_25.png 2x"
        data-sizes="auto"
        alt="./pic/8_25.png"
        title="./pic/8_25.png" /></p>
<hr>
<p><strong>Normalization of CFG</strong></p>
<ul>
<li>Chomsky Normal Form (CNF), if every production is in form: $A\to BC|a$</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_26.png"
        data-srcset="./pic/8_26.png, ./pic/8_26.png 1.5x, ./pic/8_26.png 2x"
        data-sizes="auto"
        alt="./pic/8_26.png"
        title="./pic/8_26.png" /></p>
<hr>
<h3 id="84-first-and-follow-sets">8.4 First and Follow Sets</h3>
<p><strong>First</strong></p>
<ul>
<li>First(S) is the set of all terminals that may <strong>begin</strong> the strings in the language generated by S.</li>
</ul>
<p><em>[Examples]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_30.png"
        data-srcset="./pic/8_30.png, ./pic/8_30.png 1.5x, ./pic/8_30.png 2x"
        data-sizes="auto"
        alt="./pic/8_30.png"
        title="./pic/8_30.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_31.png"
        data-srcset="./pic/8_31.png, ./pic/8_31.png 1.5x, ./pic/8_31.png 2x"
        data-sizes="auto"
        alt="./pic/8_31.png"
        title="./pic/8_31.png" /></p>
<p><strong>Follow</strong></p>
<ul>
<li>Follow(A) is the set of all terminals that may <strong>follow</strong> to the right of (A) in any form of sentential Grammar.</li>
<li>Rules:
<ul>
<li>if A is the start symbol then Follow(A) = {$}</li>
<li>if $A \to \alpha A B, B \to \varepsilon$, Follow(A) = First(B)</li>
<li>if $S \to \alpha A$ Follow(A) = Follow(S)</li>
<li>$S \to \alpha A \beta$, where $\beta \to \varepsilon$, Follow(A) = First(B) U Follow(S) - {$\varepsilon$}</li>
</ul>
</li>
</ul>
<p><em>[Examples]</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_27.png"
        data-srcset="./pic/8_27.png, ./pic/8_27.png 1.5x, ./pic/8_27.png 2x"
        data-sizes="auto"
        alt="./pic/8_27.png"
        title="./pic/8_27.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_28.png"
        data-srcset="./pic/8_28.png, ./pic/8_28.png 1.5x, ./pic/8_28.png 2x"
        data-sizes="auto"
        alt="./pic/8_28.png"
        title="./pic/8_28.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./pic/8_29.png"
        data-srcset="./pic/8_29.png, ./pic/8_29.png 1.5x, ./pic/8_29.png 2x"
        data-sizes="auto"
        alt="./pic/8_29.png"
        title="./pic/8_29.png" /></p>
<hr>
<p><em><strong>学习笔记，仅供参考</strong></em></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2023-11-29</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/sp/l/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/serverfile/server-build/" class="prev" rel="prev" title="Hugo个人博客搭建(极简版)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Hugo个人博客搭建(极简版)</a></div>
</div>

<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"gVyw2XjY83zqSfHqJBAeOgjR-MdYXbMMI","appKey":"a5Yl6yevpS8Bwp4G4790edGK","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-CN","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"data":{"id-1":"山雨欲来风满楼的网站","id-2":"山雨欲来风满楼的网站"},"lightgallery":true,"search":{"algoliaAppID":"SACBDHJDQ3","algoliaIndex":"ShanSearch","algoliaSearchKey":"37347a56eb55bf14a8d7cc96bf602045","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@2.1.3/dist/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script><script type="text/javascript" src="/js/custom.js"></script></body>
</html>
